<?php
session_start();
include_once("config.ini.php");
include_once("config.ini.curl.php");
//include_once('config.php');

if (!$auth->isLogged()) {
    $_SESSION['redirect'] = 'trip/origin-destination/' . $_GET['transport'];
    header("Location:" . SITE . "login");
}

if (!isset($_GET["idtrip"]) && !isset($_GET['transport']))
    header("Location:" . SITE . "trip/how-are-you-traveling");

$transport = (isset($_GET['transport']) && !empty($_GET['transport'])) ? $_GET['transport'] : '';

$trip = '';
$travelmode = 'DRIVING';
$label = 'Flight';
$label_station = 'Airport';
$vihicle_place_holder = "";
$multiCityLabel = "Multi City";

switch ($transport) {
    case 'vehicle':
        $travelmode = 'DRIVING';
        $label = 'Vehicle';
        $label_station = 'Point';
        $vihicle_place_holder = "Enter Final Destination";
        $multiCityLabel = "Multiple Stops (Road Trip)";
        break;
    case 'train':
        $travelmode = 'TRANSIT';
        $label = 'Train';
        $label_station = 'Railway Station';
        break;
}

$output = '';
if (isset($_POST['location_submit'])) {

    $from = $_POST["location_from"];
    $to = $_POST["location_to"];
    $from_latlng = $_POST["location_from_latlng"];
    $to_latlng = $_POST["location_to_latlng"];
    $transport = filter_var($_GET["transport"], FILTER_SANITIZE_STRING);
    $filter = array();
    if (isset($_POST['filter_option'])) {
        $filter = $_POST['filter_option'];
    }
    $embassis = '';
    if (isset($_POST['embassy_list'])) {
        $embassis = $_POST['embassy_list'];
    }

    $location_triptype = $_POST['location_triptype'];
    $location_datel = $_POST['location_datel'];
    $location_datel_deptime = $_POST['location_datel_deptime'];
    $location_datel_arrtime = $_POST['location_datel_arrtime'];
    $dep_flight_no = "";
    if (isset($_POST['dep_flight_no'])) {
        $dep_flight_no = $_POST['dep_flight_no'];
    }
    $dep_seat_no = "";
    if (isset($_POST['dep_seat_no'])) {
        $dep_seat_no = $_POST['dep_seat_no'];
    }
    $location_dater = $_POST['location_dater'];
    $location_dater_deptime = $_POST['location_dater_deptime'];
    $location_dater_arrtime = $_POST['location_dater_arrtime'];
    $ret_flight_no = "";
    if (isset($_POST['ret_flight_no'])) {
        $ret_flight_no = $_POST['ret_flight_no'];
    }
    $ret_seat_no = "";
    if (isset($_POST['ret_seat_no'])) {
        $ret_seat_no = $_POST['ret_seat_no'];
    }
    $hotel_name = $_POST['hotel_name'];
    $hotel_date_checkin = $_POST['hotel_date_checkin'];
    $hotel_date_checkout = $_POST['hotel_date_checkout'];
    $rental_agency = $_POST['rental_agency'];
    $rental_date_pick = $_POST['rental_date_pick'];
    $rental_date_drop = $_POST['rental_date_drop'];
    $location_from_flightportion = '';
    if (isset($_POST['location_from_flightportion'])) {
        $location_from_flightportion = $_POST['location_from_flightportion'];
    }
    $location_to_flightportion = '';
    if (isset($_POST['location_to_flightportion'])) {
        $location_to_flightportion = $_POST['location_to_flightportion'];
    }
    $location_from_latlng_flightportion = '';
    if (isset($_POST['location_from_latlng_flightportion'])) {
        $location_from_latlng_flightportion = $_POST['location_from_latlng_flightportion'];
    }
    $location_to_latlng_flightportion = '';
    if (isset($_POST['location_to_latlng_flightportion'])) {
        $location_to_latlng_flightportion = $_POST['location_to_latlng_flightportion'];
    }

    $location_from_drivingportion = $_POST['location_from_drivingportion'];
    $location_to_drivingportion = $_POST['location_to_drivingportion'];
    $location_from_latlng_drivingportion = $_POST['location_from_latlng_drivingportion'];
    $location_to_latlng_drivingportion = $_POST['location_to_latlng_drivingportion'];
    $location_from_trainportion = $_POST['location_from_trainportion'];
    $location_to_trainportion = $_POST['location_to_trainportion'];
    $location_from_latlng_trainportion = $_POST['location_from_latlng_trainportion'];
    $location_to_latlng_trainportion = $_POST['location_to_latlng_trainportion'];
    $multi_waypoint_seat_no = isset($_POST['multi_waypoint_seat_no']) ? $_POST['multi_waypoint_seat_no'] : "";
    $multi_waypoint_flight_no = isset($_POST['multi_waypoint_flight_no']) ? $_POST['multi_waypoint_flight_no'] : "";
    $location_multi_waypoint = isset($_POST['multi_location_waypoint']) ? $_POST['multi_location_waypoint'] : "";
    $location_multi_waypoint_date = isset($_POST['multi_location_waypoint_date']) ? $_POST['multi_location_waypoint_date'] : "";
    $location_multi_waypoint_dep_date = isset($_POST['multi_location_waypoint_dep_date']) ? $_POST['multi_location_waypoint_dep_date'] : "";
    $location_multi_waypoint_latlng = isset($_POST['location_multi_waypoint_latlng']) ? $_POST['location_multi_waypoint_latlng'] : "";
    $via_waypoints = isset($_POST['via_waypoints']) ? $_POST['via_waypoints'] : "";
    $hotel_address = "";

    if (isset($_POST['hotel_located']) && $_POST['hotel_located'] == 'on') {
        $hotel_address = 'Located at Airport';
    } else {
        $hotel_address = $_POST['hotel_address'];
    }

    $rental_agency_address = "";
    if (isset($_POST['rental_agency_located']) && $_POST['rental_agency_located'] == 'on') {
        $rental_agency_address = 'Located at Airport';
    } else {
        $rental_agency_address = $_POST['rental_agency_address'];
    }

    if (!empty($from) && !empty($to) && !empty($from_latlng) && !empty($to_latlng)) { // save data trip in DB
        include("class/class.TripPlan.php");
        $trip = new TripPlan();
        $trip->put_data($transport, $from, $to, $from_latlng, $to_latlng, $filter, $embassis, $location_triptype, $location_datel, $location_datel_deptime, $location_datel_arrtime, $dep_flight_no, $dep_seat_no, $location_dater, $location_dater_deptime, $location_dater_arrtime, $ret_flight_no, $ret_seat_no, $hotel_name, $hotel_date_checkin, $hotel_date_checkout, $rental_agency, $rental_date_pick, $rental_date_drop, $location_from_flightportion, $location_to_flightportion, $location_from_latlng_flightportion, $location_to_latlng_flightportion, $location_from_drivingportion, $location_to_drivingportion, $location_from_latlng_drivingportion, $location_to_latlng_drivingportion, $location_from_trainportion, $location_to_trainportion, $location_from_latlng_trainportion, $location_to_latlng_trainportion, "", "", $hotel_address, $rental_agency_address, json_encode($location_multi_waypoint), $location_multi_waypoint_latlng, $via_waypoints, $location_multi_waypoint_date, $location_multi_waypoint_dep_date, $multi_waypoint_flight_no, $multi_waypoint_seat_no);

        if (!$trip->error) { //header("Location:".SITE."trip/route/".$dbh->lastInsertId());
            header("Location:" . SITE . "trip/create-timeline/" . $dbh->lastInsertId());
        } else {
            $output = 'A system error has been encountered. Please try again.' . $trip->error;
            echo $output;
            exit();
        }
    } else
        $output = 'Please fill origin and destination place.';
}

include('include_doctype.php');
?>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Planiversity turns travelers into confident and well-prepared travel professionals, providing travel information beyond itinerary management">
    <meta name="keywords" content="Consolidated Travel Information Management">
    <meta name="author" content="">
    <title>PLANIVERSITY - TO AND FROM</title>

    <link rel="shortcut icon" href="<?php echo SITE; ?>favicon.ico" type="image/x-icon">
    <link rel="icon" href="<?php echo SITE; ?>favicon.ico" type="image/x-icon">

    <link href="<?php echo SITE; ?>style/menu.css" rel="stylesheet" type="text/css" />
    <link href="<?php echo SITE; ?>style/style.css" rel="stylesheet" type="text/css" />
    <link href="<?php echo SITE; ?>style/responsive.css" rel="stylesheet" type="text/css" />
    <script src="<?php echo SITE; ?>js/responsive-nav.js"></script>

    <script src="<?php echo SITE; ?>js/jquery-1.11.3.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/places.js@1.19.0"></script>

    <script>
        var SITE = '<?php echo SITE; ?>'
    </script>
    <script src="<?php echo SITE; ?>js/js_map.js"></script>
    <script src="<?php echo SITE; ?>js/global.js"></script>
    <link href="<?php echo SITE; ?>assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://unpkg.com/@duffel/components@latest/dist/CardPayment.min.css" />

    <link href="<?php echo SITE; ?>assets/css/jquery.datetimepicker.css" rel="stylesheet" type="text/css">
    <?php include('new_head_files.php'); ?>

    <script src="<?php echo SITE; ?>js/jquery.validate.min.js"></script>
    <script src="<?php echo SITE; ?>js/additional-methods.js"></script>

    <link href="<?php echo SITE; ?>style/sweetalert.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="<?php echo SITE; ?>js/sweetalert.min.js"></script>

    <script src="<?php echo SITE; ?>js/select2-dropdown.js"></script>
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <!-- <script src="https://js.stripe.com/v3/"></script> -->
    <script type="text/javascript" src="https://unpkg.com/@duffel/components@latest/dist/CardPayment.umd.min.js"></script>

    <style>
        .modaltrans {
            width: 292px;
            overflow: hidden !important;
            max-height: 300px;
            padding-left: 0px !important;
            margin-left: 14px;
        }

        .datepicker td,
        .datepicker th {
            text-align: center;
        }

        .modaltrans-body {
            transform: scale(0.25) translate(-151%, -151%);
            width: 400%;
        }

        .modaltrans-body-mozila {
            transform: scale(0.2) translate(-200%, -200%);
            width: 500%;
        }

        .finish-next-btn:hover {
            color: #FFF !important;
        }

        .algolia-places .ap-input-icon {
            margin-top: 16px;
        }

        .list-inline {
            display: none;
        }

        .right-side-link {
            display: inherit;
        }

        .affiliate_link {
            margin-left: 50px;
            position: relative;
            top: 3px;
        }

        .affiliate_link p {
            font-size: 12px;
            color: #000;
        }

        .affiliate_link p span {
            color: #048cf2;
        }

        .affiliate_link p span:hover {
            color: #048cf9;
        }

        .close-icon {
            border: 1px solid transparent;
            background-color: transparent;
            display: inline-block;
            vertical-align: middle;
            outline: 0;
            cursor: pointer;
        }

        .close-icon:after {
            content: "X";
            display: none;
            width: 15px;
            height: 18px;
            position: absolute;
            color: #000000;
            z-index: 1;
            right: 25px;
            top: 0;
            bottom: 8px;
            margin: auto;
            text-align: center;
            font-weight: normal;
            font-size: 18px;
            cursor: pointer;
        }

        .clearable:valid~.close-icon::after {
            display: block !important;
        }

        .clearable:valid~.close-icon::after {
            display: block !important;
        }

        .action_option {
            width: 100%;
            text-align: center;
        }

        .action-section {
            display: inline-block;
            position: relative;
            padding-left: 35px;
            padding-right: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 18px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Hide the browser's default radio button */
        .action-section input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        /* Create a custom radio button */
        .checkmark {
            position: absolute;
            top: 2;
            left: 0;
            height: 20px;
            width: 20px;
            background-color: #eee;
            border-radius: 50%;
        }

        /* On mouse-over, add a grey background color */
        .action-section:hover input~.checkmark {
            background-color: #ccc;
        }

        /* When the radio button is checked, add a blue background */
        .action-section input:checked~.checkmark {
            background-color: #2196F3;
        }

        /* Create the indicator (the dot/circle - hidden when not checked) */
        .action-section:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Show the indicator (dot/circle) when checked */
        .action-section input:checked~.checkmark:after {
            display: block;
        }

        /* Style the indicator (dot/circle) */
        .action-section .checkmark:after {
            top: 5px;
            left: 5px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: white;
        }

        .select {
            position: relative;
            display: block;
            margin-bottom: 15px;
            width: 100% !important;
        }

        .select select {
            display: inline-block;
            width: 100%;
            cursor: pointer;
            padding: 10px 15px;
            outline: 0;
            border: 0;
            border-radius: 0;
            background: #e6e6e6;
            color: #7b7b7b;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        span.select2-container {
            z-index: 10050;
        }

        label.error {
            color: #ff044a !important;
            font-size: 14px;
            margin-top: 3px;
        }

        .extra-option {
            height: 40px !important;
        }

        .widget-26 {
            color: #3c4142;
            font-weight: 400;
        }

        .widget-26 tr:first-child td {
            border: 0;
        }

        .widget-26 .widget-26-job-emp-img img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
        }

        .widget-26 .widget-26-job-title {
            min-width: 200px;
        }

        .widget-26 .widget-26-job-title a {
            font-weight: 400;
            font-size: 0.875rem;
            color: #3c4142;
            line-height: 1.5;
        }

        .widget-26 .widget-26-job-title a:hover {
            color: #68CBD7;
            text-decoration: none;
        }

        .widget-26 .widget-26-job-title .employer-name {
            margin: 0;
            line-height: 1.5;
            font-weight: 400;
            color: #3c4142;
            font-size: 0.8125rem;
            color: #3c4142;
        }

        .widget-26 .widget-26-job-title .employer-name:hover {
            color: #68CBD7;
            text-decoration: none;
        }

        .widget-26 .widget-26-job-title .time {
            font-size: 12px;
            font-weight: 400;
        }

        .widget-26 .widget-26-job-info {
            min-width: 100px;
            font-weight: 400;
        }

        .widget-26 .widget-26-job-info p {
            line-height: 1.5;
            color: #3c4142;
            font-size: 0.8125rem;
        }

        .widget-26 .widget-26-job-info .location {
            color: #3c4142;
        }

        .widget-26 .widget-26-job-salary {
            min-width: 70px;
            font-weight: 500;
            color: #3c4142;
            font-size: 1rem;
        }

        .widget-26 .widget-26-job-category {
            display: block;
            padding: .3rem;
            white-space: nowrap;
            border-radius: 15px;
        }

        .widget-26 .widget-26-job-category .indicator {
            width: 13px;
            height: 13px;
            margin-right: .5rem;
            float: left;
            border-radius: 50%;
        }

        .widget-26 .widget-26-job-category span {
            font-size: 0.8125rem;
            color: #3c4142;
            font-weight: 600;
        }

        .widget-26 .widget-26-job-starred svg {
            width: 20px;
            height: 20px;
            color: #fd8b2c;
        }

        .widget-26 .widget-26-job-starred svg.starred {
            fill: #fd8b2c;
        }

        .bg-soft-base {
            background-color: #e1f5f7;
        }

        .bg-soft-warning {
            background-color: #fff4e1;
        }

        .bg-soft-success {
            background-color: #d1f6f2;
        }

        .bg-soft-danger {
            background-color: #fedce0;
        }

        .bg-soft-info {
            background-color: #d7efff;
        }

        .search-form {
            width: 80%;
            margin: 0 auto;
            margin-top: 1rem;
        }

        .search-form input {
            height: 100%;
            background: transparent;
            border: 0;
            display: block;
            width: 100%;
            padding: 1rem;
            height: 100%;
            font-size: 1rem;
        }

        .search-form select {
            background: transparent;
            border: 0;
            padding: 1rem;
            height: 100%;
            font-size: 1rem;
        }

        .search-form select:focus {
            border: 0;
        }

        .search-form button {
            height: 100%;
            width: 100%;
            font-size: 1rem;
        }

        .search-form button svg {
            width: 24px;
            height: 24px;
        }

        .search-body {
            margin-bottom: 1.5rem;
        }

        .search-body .search-filters .filter-list {
            margin-bottom: 1.3rem;
        }

        .search-body .search-filters .filter-list .title {
            color: #3c4142;
            margin-bottom: 1rem;
        }

        .search-body .search-filters .filter-list .filter-text {
            color: #727686;
        }

        .search-body .search-result .result-header {
            margin-bottom: 2rem;
        }

        .search-body .search-result .result-header .records {
            color: #3c4142;
            margin-left: 10px;
        }

        .search-body .search-result .result-header .result-actions {
            text-align: right;
            /* display: flex; */
            align-items: center;
            justify-content: space-between;
            display: inline-flex;
            margin-left: 10px;
        }

        .search-body .search-result .result-header .result-actions .result-sorting {
            display: flex;
            align-items: center;
        }

        .search-body .search-result .result-header .result-actions .result-sorting span {
            flex-shrink: 0;
            font-size: 0.8125rem;
        }

        .search-body .search-result .result-header .result-actions .result-sorting select {
            color: #68CBD7;
            margin-left: 10px;
        }

        .search-body .search-result .result-header .result-actions .result-sorting select option {
            color: #3c4142;
        }

        @media (min-width: 768px) and (max-width: 991.98px) {
            .search-body .search-filters {
                display: flex;
            }

            .search-body .search-filters .filter-list {
                margin-right: 1rem;
            }
        }

        .card-margin {
            margin-bottom: 1.875rem;
        }

        @media (min-width: 992px) {
            .col-lg-2 {
                flex: 0 0 16.66667%;
                max-width: 16.66667%;
            }
        }

        .card-margin {
            margin-bottom: 1.875rem;
        }

        .card {
            border: 0;
            box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
            -webkit-box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
            -moz-box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
            -ms-box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
        }

        .card {
            position: relative;
            display: flex;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #ffffff;
            background-clip: border-box;
            border: 1px solid #e6e4e9;
            border-radius: 8px;
        }

        .loading_screen {
            position: absolute;
            text-align: center;
            left: 45%;
            top: 10%;
        }

        .loading_screen i {
            font-size: 80px;
            color: #0886e3;
        }

        .flight-deatils {
            display: flex;
            justify-content: space-around;
        }

        .table tr {
            border-bottom: 2px solid #f5f5f5;
            padding-bottom: 10px;
        }

        .flight-origin p {
            font-size: 14px;
            margin-bottom: 2px
        }

        .flight-origin p.timetable {
            font-weight: 500;
        }

        .flight-details__line {
            height: 1px;
            background: #E2E2E8;
        }

        .flight-details__line::after {
            content: "";
            width: 0;
            height: 0;
            border-top: 3px solid transparent;
            border-bottom: 3px solid transparent;
            border-left: 6px solid var(--GREY-200);
            position: absolute;
            left: 163px;
            top: 20px;
        }

        .flight-duration {
            text-align: center;
        }

        .book-button {
            padding: 8px 20px;
            font-size: 12px;
            border: 1px solid #1c73b8;
            font-weight: 500;
            background: #1c73b8;
            color: #fff;
        }

        .input--style-1 {
            font-size: 18px;
            padding: 16.5px 20px;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            color: #666;
            background: #fff;
        }



        /* ==========================================================================
        #SELECT
        ========================================================================== */
        .quantity {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            float: right;
        }

        @media (max-width: 575px) {
            .quantity {
                float: none;
                margin-top: 10px;
            }
        }

        .quantity>input {
            -webkit-appearance: none;
            width: 55px;
            text-align: center;
            font-size: 18px;
            color: #555;
            font-weight: 700;
            border: none;
            height: 20px;
            outline: none;
            margin: 0;
            box-shadow: none;
        }

        .minus,
        .plus {
            display: inline-block;
            width: 32px;
            height: 32px;
            line-height: 26px;
            text-align: center;
            border: 2px solid #ccc;
            font-size: 24px;
            color: #ccc;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-transition: all 0.4s ease;
            -o-transition: all 0.4s ease;
            -moz-transition: all 0.4s ease;
            transition: all 0.4s ease;
        }

        .minus:hover,
        .plus:hover {
            background: #6c7ae0;
            border-color: #6c7ae0;
            color: #fff;
        }

        .list-room {
            list-style: none;
            max-height: 324px;
            overflow-y: auto;
            padding-right: 20px;
        }

        .list-room__item {
            margin-bottom: 20px;
        }

        .list-room__footer {
            padding-top: 22px;
            border-top: 1px solid #e5e5e5;
        }

        .list-room__name {
            margin-bottom: 27px;
            display: block;
            font-weight: 700;
            color: #999;
        }

        .list-person {
            list-style: none;
        }

        .list-person .list-person__item:last-child {
            margin-bottom: 0;
        }

        .list-person__item {
            margin-bottom: 20px;
        }

        .list-person__item::after {
            content: "";
            clear: both;
            display: table;
        }

        .list-person__item .name {
            font-size: 18px;
            color: #555;
            font-weight: 700;
            display: inline-block;
            margin-top: 5px;
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #btn-add-room {
            font-family: inherit;
            font-size: 16px;
            color: #6c7ae0;
            font-weight: 700;
            -webkit-transition: all 0.4s ease;
            -o-transition: all 0.4s ease;
            -moz-transition: all 0.4s ease;
            transition: all 0.4s ease;
        }

        #btn-add-room:hover {
            text-decoration: underline;
        }

        .dropdown-select {
            display: none;
            font-family: "Lato", "Arial", "Helvetica Neue", sans-serif;
            position: absolute;
            min-width: 385px;
            left: 0;
            right: 0;
            top: -webkit-calc(100% + 2px);
            top: -moz-calc(100% + 2px);
            top: calc(100% + 2px);
            background: #fff;
            z-index: 999;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
            -moz-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
            box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
            padding: 10px;
            padding-right: 25px;
        }

        .dropdown-select.show {
            display: block;
        }

        li.children-item {
            display: flex;
            justify-content: space-between;
        }

        li.children-list,
        li.infant-list {
            border: 1px solid #d1d1d1;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 10px;
        }

        li.children-item .name {
            position: relative;
            top: 10px;
        }

        select.child-age {
            width: 50px;
            text-align: right;
        }

        ul.common-list {
            list-style: none;
            margin-left: 0;
            padding-right: 0;
        }

        ul.children-person {
            margin-left: 0;
        }


        .markup-location {
            padding-top: 4px;
            padding-bottom: 3px;
        }

        .m-icon {
            float: left;
            width: 30px;
            margin-right: 10px;
            text-align: center;
        }

        .m-icon i {
            width: 100%;
            height: auto;
            border-radius: 2px;
        }

        .m-content {
            margin-left: 40px;
        }

        .m-content p {
            font-size: 14px;
            color: black;
            font-weight: bold;
            word-wrap: break-word;
            line-height: 1.1;
            margin-bottom: 4px;
        }

        .m-content p span {
            display: block;
            font-weight: 400;
            color: #343B53;
        }

        input.trip_style {
            opacity: 1 !important;
        }

        i.fa.fa-plane.extra-icon {
            position: relative;
            left: 50%;
            bottom: 10px;
            color: #058bee;
        }

        .custom-content {
            background-color: #fff;
        }

        #master_modal {
            z-index: 9999;
            top: 20px;
            margin-bottom: 20px !important;
        }

        #schedule-modal {
            overflow: scroll;
        }

        .modal-backdrop {
            background-color: #000;
            z-index: 1111;
        }

        .modal-blur {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }


        .flight_heading .flight_destination h4 {
            font-size: 16px;
            line-height: 24px;
        }

        .flight_fact {
            background: #e7dfdf;
            display: inline-block;
            padding: 5px;
            border-radius: 2px;
            text-align: center;
            font-size: 13px;
            margin-left: 20px;
        }

        .flight_spot p {
            margin-bottom: 2px;
            font-size: 14px;
            font-weight: 400;
        }

        ul.flight_spot li {
            margin-top: 10px;
        }

        .no-data {
            text-align: center;
            display: block;
        }

        .no-data i {
            color: #9ea5ab;
            font-size: 30px;
        }

        button.page-link.no-border:disabled {
            color: #d1d1d1;
            opacity: 1;
            cursor: not-allowed;
        }

        .no-data p {
            font-size: 24px;
            margin-bottom: 50px;
            color: #6a6f72;
        }


        .payment_heading h4 {
            font-size: 18px;
            text-align: center;
            padding-bottom: 10px;
        }

        .payment_body h4 {
            font-size: 16px;
            margin-bottom: 0;
            padding: 0;
            line-height: 40px;
        }

        .payment_body {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-radius: 10px;
        }


        .amount_section p {
            margin: 0;
            font-size: 20px;
            background: #b1a9a9;
            padding: 5px 20px;
            color: #fff;
            border-radius: 5px;
        }


        .StripeElement {
            box-sizing: border-box;
            width: 100%;
            height: 50px;
            padding: 15px 12px;
            border: 1px solid #a2a2a2;
            border-radius: 4px;
            background-color: white;
            box-shadow: 0 1px 3px 0 #e6ebf1;
            -webkit-transition: box-shadow 150ms ease;
            transition: box-shadow 150ms ease;
            font-size: 16px;
        }

        .stripe_process {
            width: 100%;
            padding: 10px;
            text-align: center;
            color: white;
            background: #337ab7;
            border-color: #337ab7;
            border-radius: 7px;
            font-size: 16px;
            margin-top: 15px;
        }

        div#card-errors {
            color: #e13232;
        }

        .payment {
            margin-top: 20px;
        }

        .payment_loading_screen {
            position: absolute;
            text-align: center;
            left: 40%;
            top: 15%;
        }

        .payment_loading_screen i {
            font-size: 90px;
            color: #0886e3;
        }

        .pay-row {
            margin-left: -15px;
            margin-right: -15px;
        }

        .duffel-components .card-payment__container {
            width: auto;
        }


        #payment-form p {
            margin-bottom: 5px;
        }

        .flight_booking {
            padding: 8px 15px;
            display: block;
        }

        #order-form-complete label {
            font-weight: 500;
            font-size: 13px;
        }

        #order-form-complete .form-control.error {
            border: 1px solid #e10f0f;
        }

        .extra-option-complete {
            height: 32px !important;
            font-size: 13px;
        }

        .response-message p {
            text-align: center;
            font-size: 16px;
            background: #b3bec7;
            padding: 10px 20px;
            color: #fff;
        }

        .response-message p.warn {
            background: #e12121;
        }

        .card-content.action-content {
            text-align: center;
        }

        .try_again {
            padding: 5px 11px;
            font-size: 14px;
            font-weight: 500;
        }

        .response-message li {
            font-size: 14px;
        }

        .foot-note {
            text-align: center;
            background: #5d6e8a;
            padding: 5px;
            border-radius: 5px;
            margin-top: 30px;
            margin-bottom: 10px;
        }

        .foot-note p {
            font-size: 14px;
            margin-bottom: 0;
            color: #fff;
        }


        /* .open .input-icon::before {
            -webkit-transform: rotate(-180deg);
            -moz-transform: rotate(-180deg);
            -ms-transform: rotate(-180deg);
            -o-transform: rotate(-180deg);
            transform: rotate(-180deg);
        }

        .open .input-icon.zmdi-plus:before {
            content: '\f273';
        } */
    </style>
</head>

<body class="custom_toandfrom">

    <!--<div class="content">-->

    <?php
    //include('include_header.php')
    include('new_backend_header.php');

    include('new_backend_footer.php');
    ?>
    <div class="navbar-custom old-site-colors">
        <div class="container-fluid">
            <div id="navigation">
                <ul class="navigation-menu text-center plan-nav">
                    <!--<li class="box">-->
                    <!--    <a href="" class="left-nav-button top-progress scale" data-toggle="modal"-->
                    <!--       data-target="#schedule-modal">-->
                    <!--        <img src="<?php echo SITE; ?>assets/images/step_calendar.png" alt="Schedule">-->
                    <!--        <p>Schedule</p>-->
                    <!--    </a>-->
                    <!--</li>-->
                    <!--<li class="step-arrow">-->
                    <!--    <a href="" class="left-nav-button top-progress">-->
                    <!--        <img src="<?php echo SITE; ?>assets/images/step_notes.png" alt="Notes">-->
                    <!--        <p>Notes</p>-->
                    <!--    </a>-->
                    <!--</li>-->
                    <!--<li class="step-arrow">-->
                    <!--    <a href="" class="left-nav-button top-progress">-->
                    <!--        <img src="<?php echo SITE; ?>assets/images/step_filters.png" alt="Filters">-->
                    <!--        <p>Filters</p>-->
                    <!--    </a>-->
                    <!--</li>-->
                    <!--<li class="step-arrow">-->
                    <!--    <a href="" class="left-nav-button top-progress">-->
                    <!--        <img src="<?php echo SITE; ?>assets/images/step_documents.png" alt="Documents">-->
                    <!--        <p>Documents</p>-->
                    <!--    </a>-->
                    <!--</li>-->
                    <!--<li class="step-arrow">-->
                    <!--    <a href="<?php echo SITE; ?>trip/connect/<?php echo $_GET['idtrip']; ?>"-->
                    <!--       class="left-nav-button top-progress">-->
                    <!--        <img src="<?php echo SITE; ?>assets/images/step_connect_sources.png" alt="Connect">-->
                    <!--        <p>Connect</p>-->
                    <!--    </a>-->
                    <!--</li>-->
                    <!--<li class="step-arrow">-->
                    <!--    <a href="" class="left-nav-button top-progress">-->
                    <!--        <img src="<?php echo SITE; ?>assets/images/step_pdf.png" alt="Export">-->
                    <!--        <p>Export</p>-->
                    <!--    </a>-->
                    <!--</li>-->
                    <li>
                        <a href="<?php echo SITE; ?>trip/create-timeline/<?php echo $_GET['idtrip']; ?>" class="left-nav-button scale" data-toggle="modal" data-target="#schedule-modal">
                            <!--<img src="<?php echo SITE; ?>assets/images/step_calendar.png" alt="Schedule">-->
                            <p class="main-color"><img class="mr-2" src="<?php echo SITE; ?>images/calendar_check.png" alt="Schedule">Schedule</p>
                        </a>
                    </li>
                    <li>
                        <a href="<?php echo SITE; ?>trip/plan-notes/<?php echo $_GET['idtrip']; ?>" class="left-nav-button">
                            <!--<img src="<?php echo SITE; ?>assets/images/step_notes.png" alt="Notes">-->
                            <p class="main-color"><img class="mr-2" src="<?php echo SITE; ?>images/file_blank.png" alt="Schedule">Notes</p>
                        </a>
                    </li>
                    <li>
                        <a href="<?php echo SITE; ?>trip/filters/<?php echo $_GET['idtrip']; ?>" class="left-nav-button">
                            <!--<img src="<?php echo SITE; ?>assets/images/step_filters.png" alt="Filters">-->
                            <p class="main-color"><img class="mr-2" src="<?php echo SITE; ?>images/slider_02.png" alt="Schedule">Filters</p>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="left-nav-button">
                            <!--<img src="<?php echo SITE; ?>assets/images/step_filters.png" alt="Filters">-->
                            <p class="main-color"><img class="mr-2" src="<?php echo SITE; ?>images/plans.png" alt="Schedule">Plans</p>
                        </a>
                    </li>
                    <li>
                        <a href="<?php echo SITE; ?>trip/travel-documents/<?php echo $_GET['idtrip']; ?>" class="left-nav-button">
                            <!--<img src="<?php echo SITE; ?>assets/images/step_documents.png" alt="Documents">-->
                            <p class="main-color"><img class="mr-2" src="<?php echo SITE; ?>images/folder_open.png" alt="Schedule">Documents</p>
                        </a>
                    </li>
                    <li>
                        <a href="<?php echo SITE; ?>trip/connect/<?php echo $_GET['idtrip']; ?>" class="left-nav-button">
                            <!--<img src="<?php echo SITE; ?>assets/images/step_connect_sources.png" alt="Connect">-->
                            <p class="main-color"><img class="mr-2" src="<?php echo SITE; ?>images/share_outline.png" alt="Schedule">Connect</p>
                        </a>
                    </li>
                    <li>
                        <a href="<?php echo SITE; ?>trip/add-employee-profile/<?php echo $_GET['idtrip']; ?>" class="left-nav-button">
                            <!--<img src="<?php echo SITE; ?>assets/images/step_pdf.png" alt="Export">-->
                            <p class="main-color"><img class="mr-2" src="<?php echo SITE; ?>images/download.png" alt="Schedule">Export</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    </header>

    <div class="modal fade modal-blur" tabindex="-1" role="dialog" id="master_modal" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content custom-content">
                <div class="modal-header">
                    <h5 class="modal-title">Flight Details</h5>

                </div>
                <div class="modal-body">


                    <div class="row">

                        <div class="flight_timeline col-lg-7">

                        </div>

                        <div class="flight_payment col-lg-5">

                            <div class="payment_heading">
                                <h4>Payment and Order Confirm</h4>
                            </div>

                            <div class="payment_loading_screen" style="display: none; ">
                                <i class='fa fa-spinner fa-spin'></i>
                            </div>

                            <div class="payment_container" style="display:none;">

                                <div class="payment_body">
                                    <h4>Amount</h4>

                                    <div class="amount_section">
                                        <p id="amount_target">$0.0</p>
                                    </div>

                                </div>

                                <div class="payment">
                                    <div class="card-info">
                                        <div class="card-content">
                                            <div id="payment_target"></div>
                                        </div>
                                        <div class="foot-note">
                                            <p>Traveler information will be entered after purchasing the ticket</p>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="traveller_container" style="display:none;">


                                <div class="payment">
                                    <div class="card-info">
                                        <div class="card-content">


                                            <form id="order-form-complete">

                                                <div id="traveler_inputs"></div>

                                                <div class="row mb-3 pay-row">
                                                    <div class="col-xl-12 col-12 padding_left">
                                                        <button type="submit" class="btn btn-primary float-right mt-4 mb-5 flight_booking">Complete Booking</button>
                                                    </div>
                                                </div>

                                            </form>


                                        </div>
                                    </div>
                                </div>



                            </div>

                            <div class="message_container" style="display:none;">

                                <div class="payment">
                                    <div class="card-info">
                                        <div class="card-content">
                                            <div class="response-message">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="action_container" style="display:none;">

                                <div class="payment">
                                    <div class="card-info">
                                        <div class="card-content action-content">
                                            <button class="btn btn-secondary try_again">Try Again</button>
                                        </div>
                                    </div>
                                </div>

                            </div>



                        </div>

                    </div>





                </div>
                <div class=" modal-footer">
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                    <button type="button" class="btn btn-secondary master_modal_click" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <div data-backdrop="false" id="schedule-modal" class="modal fade bs-example-modal-lg modal-to-and-from toandfrom pt-3 location_form_1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;top: 134px">

        <div class="modal-dialog modal-lg mt-xs-0 pt-xs-0 mt-sm-0 mt-md-0 mt-lg-3">
            <div class="modal-content modal-content-white">
                <div class="modal-header bb-none pt-4">
                    <button type="button" class="close" aria-hidden="true">-</button>
                    <h4 class="modal-title" id="myLargeModalLabel">Build Your Itinerary</h4>
                </div>
                <div class="col-md-12 text-center">

                </div>

                <div class="modal-body" id="schedule-modal-body">


                    <fieldset>
                        <div class="trip-type-wrap">

                            <div class="row">
                                <div class="col-lg-6 col-xl-6"></div>
                                <div class="col-lg-6 col-xl-6 change_mode_item">
                                    <div class="form-group">
                                        <label>Change Mode of Travel</label>
                                        <select class="form-control" id="change-travel-method">
                                            <option value="vehicle" <?php if ($_GET['transport'] == 'vehicle') echo 'selected'; ?>>By Vehicle</option>
                                            <option value="plane" <?php if ($_GET['transport'] == 'plane') echo 'selected'; ?>>By Plane</option>
                                            <option value="train" <?php if ($_GET['transport'] == 'train') echo 'selected'; ?>>By Train</option>
                                        </select>
                                    </div>
                                </div>
                            </div>


                        </div>

                    </fieldset>


                    <fieldset class="action_option">

                        <label class="action-section">Book a <?= $label; ?>
                            <input type="radio" checked="checked" value="book" name="action_option_value" class="action_option_value">
                            <span class="checkmark"></span>
                        </label>
                        <label class="action-section">Build the <?= $label; ?> Itinerary
                            <input type="radio" name="action_option_value" value="build" class="action_option_value">
                            <span class="checkmark"></span>
                        </label>


                    </fieldset>


                    <fieldset id="booking_place">

                        <?php if ($transport == 'vehicle') { ?>

                            <div class="row mt-5 mb-5">

                                <div class="col-sm-12">

                                    <script src="//tp.media/content?promo_id=4578&shmarker=311162&campaign_id=130&trs=171390&locale=en&powered_by=false&border_radius=5&plain=false&show_logo=false&color_background=%23f5d361&color_button=%235a9854" charset="utf-8"></script>

                                </div>

                            </div>


                        <?php } elseif ($transport == 'plane') { ?>

                            <form id="flight_initial_form">




                                <div class="row mt-4 mb-2">
                                    <div class="col-md-2 pe-0 col-sm-12">
                                        <label class="radio"> <input type="radio" value="one" name="trip_style" class="trip_style" checked> One way <span></span> </label>
                                    </div>

                                    <div class="col-md-2 pe-0 col-sm-12">
                                        <label class="radio"> <input type="radio" value="round" name="trip_style" class="trip_style"> Roundtrip <span></span> </label>
                                    </div>


                                </div>





                                <div class="row">

                                    <div class="col-sm-12">

                                    </div>

                                    <div class="col-sm-6">

                                        <label class="mr-b-10">Origin Airport </label>
                                        <div class="group">
                                            <select class="form-control select" id="from_location"></select>
                                            <input type="hidden" class="form-control input-field validy" name="from_location_code" id="from_location_code" readonly>
                                        </div>

                                    </div>

                                    <div class="col-sm-6">

                                        <label class="mr-b-10">Destination Airport</label>
                                        <div class="group">
                                            <select class="form-control select" id="to_location"></select>
                                            <input type="hidden" class="form-control input-field validy" name="to_location_code" id="to_location_code" readonly>
                                        </div>

                                    </div>

                                </div>


                                <div class="row mt-3">

                                    <div class="col-md-12 col-lg-3">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Travellers</label>
                                            <div class="">
                                                <div class="input-group-icon" id="js-select-special">
                                                    <input class="dashboard-form-control extra-option" type="text" name="passengers" value="1 Person" disabled="disabled" id="info">
                                                </div>
                                                <div class="dropdown-select">
                                                    <ul class="list-room">
                                                        <li class="list-room__item mt-4">
                                                            <ul class="list-person">
                                                                <li class="list-person__item">
                                                                    <span class="name">Adults</span>
                                                                    <div class="quantity quantity1">
                                                                        <span class="minus a__minus">-</span>
                                                                        <input class="inputQty" type="number" min="1" value="1" name="adults" readonly>
                                                                        <span class="plus a__plus">+</span>
                                                                    </div>
                                                                </li>
                                                                <li class="list-person__item">
                                                                    <span class="name">Children</span>
                                                                    <div class="quantity quantity2">
                                                                        <span class="minus c__minus">-</span>
                                                                        <input class="inputQty" type="number" min="0" value="0" name="childs" readonly>
                                                                        <span class="plus c__plus">+</span>
                                                                    </div>
                                                                </li>

                                                                <ul class="common-list child-list"></ul>

                                                                <li class="list-person__item">
                                                                    <span class="name">Infants</span>
                                                                    <div class="quantity quantity3">
                                                                        <span class="minus i__minus">-</span>
                                                                        <input class="inputQty" type="number" min="0" value="0" name="infants" readonly>
                                                                        <span class="plus i__plus">+</span>
                                                                    </div>
                                                                </li>
                                                                <ul class="common-list infant-list"></ul>
                                                            </ul>
                                                        </li>
                                                    </ul>

                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-md-12 col-lg-3">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Date of Departure</label>
                                            <div class="date_picker_item">
                                                <input type="text" class="dashboard-form-control datepicker_one extra-option" placeholder="Date of Departure" name="departure_flight_date" value="" autocomplete="off" required="">
                                                <i class="fa fa-calendar" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12 col-lg-3" id="return_flight_section" style="display: none;">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Return Date</label>
                                            <div class="date_picker_item">
                                                <input type="text" class="dashboard-form-control datepicker_one extra-option" placeholder="Return Date" name="return_flight_date" value="" autocomplete="off" required="">
                                                <i class="fa fa-calendar" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12 col-lg-3">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Cabin Class</label>
                                            <div class="date_picker_item">

                                                <select class="form-control extra-option" name="class">
                                                    <option value="">Any</option>
                                                    <option value="economy">Economy</option>
                                                    <option value="business">Business</option>
                                                    <option value="premium_economy">Premium Economy</option>
                                                    <option value="first">First</option>
                                                </select>

                                            </div>
                                        </div>
                                    </div>

                                </div>


                                <div class="row">

                                    <!-- <button type="button" class="btn btn-info" data-toggle="modal" data-target="#master_modal">Launch Modal</button> -->



                                    <div class="col-sm-12">
                                        <input type="hidden" name="steps" id="steps" readonly value="0">
                                        <input type="hidden" name="sorts" id="sorts" readonly value="total_amount">

                                        <button type="submit" class="btn btn-primary float-right mt-4 finish-next-btn mb-5 flight_search">Find Flights</button>
                                    </div>

                                </div>

                            </form>

                            <div class="row" id="search_result_section" style="display: none; ">
                                <div class="col-12">
                                    <div class="card card-margin">
                                        <div class="card-body">
                                            <div class="row search-body">
                                                <div class="col-lg-12">

                                                    <div class="loading_screen" style="display: none; ">
                                                        <i class='fa fa-spinner fa-spin'></i>
                                                    </div>

                                                    <div class="search-result">
                                                        <div class="result-header">
                                                            <div class="row">

                                                                <div class="col-lg-6">

                                                                    <div class="result-actions" style="display:none">
                                                                        <div class="result-sorting">
                                                                            <span>Sort By:</span>
                                                                            <select class="form-control border-0 flight_search" id="list_sort">
                                                                                <option value="total_amount">Price</option>
                                                                                <option value="total_duration">Flight Duration</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <div class="result-actions" style="display:none">
                                                                        <div class="result-sorting">
                                                                            <span>Steps:</span>
                                                                            <select class="form-control border-0 flight_search" id="step_sort">
                                                                                <option value="0">Direct</option>
                                                                                <option value="1">1+ Stop</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                </div>

                                                                <div class="col-lg-6">
                                                                    <div class="records text-right">Showing: <b id="results_count">0</b> result</div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                        <div class="result-body">

                                                            <div class="table-responsive">
                                                                <table class="table widget-26">
                                                                    <tbody id="search_result">
                                                                    </tbody>
                                                                </table>
                                                            </div>

                                                            <nav class="justify-content-center flight_load_more" style="display:none;">
                                                                <ul class="pagination pagination-base pagination-boxed pagination-square mb-0">
                                                                    <li class="page-item">
                                                                        <button class="page-link no-border target_action" value="null" id="previous_button" data-type="before">
                                                                            <span aria-hidden="true">Previous</span>
                                                                        </button>
                                                                    </li>

                                                                    <li class="page-item">
                                                                        <button class="page-link no-border target_action" value="null" id="next_button" data-type="after">
                                                                            <span aria-hidden="true">Next</span>
                                                                        </button>
                                                                    </li>
                                                                </ul>
                                                            </nav>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>






                                    </div>
                                </div>
                            </div>

                        <?php } else { ?>

                            <div class="row mt-5 mb-5">

                                <div class="col-sm-12">

                                    <script src="https://c91.travelpayouts.com/content?currency=USD&promo_id=4770&shmarker=311162&trs=171390&locale=en&layout=fluid&mode=train&departure-date=&arrival-date=&theme=white" charset="utf-8"></script>

                                </div>

                            </div>


                        <?php } ?>

                    </fieldset>



                    <fieldset id="build_place" style="display:none;">

                        <form name="location_form" method="post">


                            <div class="row mt-4 mb-2">

                                <div class="col-md-12 col-lg-3">
                                    <!--mgn-top-20-->
                                    <div class="mgn-top">
                                        <div class="radio form-check-inline  form-group">
                                            <input type="radio" id="location_triptype_o" value="o" name="location_triptype" checked>
                                            <label for="location_triptype_o">One Way</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-6">
                                    <div class="mgn-top">
                                        <div class="radio form-check-inline  form-group">
                                            <input type="radio" id="location_triptype_m" value="m" name="location_triptype">
                                            <label for="location_triptype_m"><?php echo $multiCityLabel; ?></label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <script>
                                function tog(v) {
                                    return v ? 'addClass' : 'removeClass';
                                }
                                $(document).on('input', '.clearable', function() {
                                    $(this)[tog(this.value)]('x');
                                }).on('mousemove', '.x', function(e) {
                                    $(this)[tog(this.offsetWidth - 18 < e.clientX - this.getBoundingClientRect().left)]('onX');
                                }).on('touchstart click', '.onX', function(ev) {
                                    ev.preventDefault();
                                    $(this).removeClass('x onX').val('').change();
                                });
                            </script>


                            <div class="row">

                                <div class="col-md-12 col-lg-6">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Starting <?php echo $label_station; ?></label>
                                        <!--<input type="text" class="dashboard-form-control input-lg" onChange="updateSubwayMap()" placeholder="Enter Starting Airport" required="">-->
                                        <input name="location_from" id="location_from" value="<?php if ($trip) echo $trip->trip_location_from; ?>" type="text" class="dashboard-form-control form-control input-lg clearable" placeholder="Enter Starting <?php echo $label_station; ?>" required>
                                        <button class="close-icon from-part" type="reset"></button>

                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-6">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Destination <?php echo $label_station; ?></label>
                                        <input name="location_to" id="location_to" value="<?php if ($trip) echo $trip->trip_location_to; ?>" type="text" class="clearable dashboard-form-control input-lg" placeholder=" <?php echo $transport == 'vehicle' ? $vihicle_place_holder : 'Enter Destination ' . $label_station; ?>" required>
                                        <button class="close-icon from-part" type="reset"></button>
                                    </div>
                                </div>
                                <input name="location_from_latlng" id="location_from_latlng" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_from_latlng; ?>">
                                <input name="location_to_latlng" id="location_to_latlng" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_to_latlng; ?>">
                                <input name="location_multi_waypoint_latlng" id="location_multi_waypoint_latlng" class="inp1" type="hidden">
                                <input name="via_waypoints" id="via_waypoints" type="hidden">
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Date of Departure</label>
                                        <div class="date_picker_item">
                                            <input type="text" class="dashboard-form-control datepicker input-lg" placeholder="Date of Departure" name="location_datel" value="<?php if ($trip) echo $trip->trip_location_datel; ?>" autocomplete="off" id="location_datel" required="">
                                            <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Departure Time (HH:MM)</label>
                                        <input type="time" class="dashboard-form-control input-lg" placeholder="Departure Time" name="location_datel_deptime" value="<?php if ($trip) echo $trip->trip_location_datel_deptime; ?>" autocomplete="off" id="location_datel_deptime" required="">
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Arrival Date</label>
                                        <div class="date_picker_item">
                                            <input type="text" class="dashboard-form-control datepicker input-lg" placeholder="Arrival Date" name="location_datel_arr" value="" autocomplete="off" id="location_datel_arr" required="">
                                            <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Arrival Time (HH:MM)</label>
                                        <input type="time" class="dashboard-form-control input-lg" placeholder="Arrival Time" name="location_datel_arrtime" value="<?php if ($trip) echo $trip->trip_location_datel_arrtime; ?>" autocomplete="off" id="location_datel_arrtime" required="">
                                    </div>
                                </div>
                            </div>
                            <?php if ($transport != 'vehicle') { ?>
                                <div class="seat_number_collapse_sec accordion1">
                                    <i class="fa fa-angle-down accordion-toggle active"></i>

                                    <div class="accordion-content default">
                                        <div class="row">
                                            <div class="col-md-12 col-lg-4">
                                                <div class="form-group frm-grp">
                                                    <label class="mr-b-10"><?php echo $label; ?> Number</label>
                                                    <input type="text" class="dashboard-form-control input-lg" placeholder="<?php echo $label; ?> Number" name="dep_flight_no" id="dep_flight_no" value="<?php if ($trip) echo $trip->trip_dep_flight_no; ?>" autocomplete="off">
                                                </div>
                                            </div>
                                            <div class="col-md-12 col-lg-4">
                                                <div class="form-group frm-grp">
                                                    <label class="mr-b-10">Seat Number</label>
                                                    <input type="text" class="dashboard-form-control input-lg" placeholder="Seat Number" name="dep_seat_no" id="dep_seat_no" value="<?php if ($trip) echo $trip->trip_dep_seat_no; ?>" autocomplete="off">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <?php } ?>
                            <div id="return">
                                <div class="row pt-2">
                                    <div class="col-md-12 col-lg-3">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Date of Return</label>
                                            <div class="date_picker_item">
                                                <input type="text" class="dashboard-form-control datepicker input-lg" placeholder="Date of Return" name="location_dater" autocomplete="off" value="<?php if ($trip) echo $trip->trip_location_dater; ?>" id="location_dater">
                                                <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->

                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 col-lg-3">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Departure Time (HH:MM)</label>
                                            <input type="time" class="dashboard-form-control input-lg" placeholder="Departure Time" name="location_dater_deptime" value="<?php if ($trip) echo $trip->trip_location_dater_deptime; ?>" autocomplete="off" id="location_dater_deptime">
                                        </div>
                                    </div>
                                    <div class="col-md-12 col-lg-3">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Arrival Date</label>
                                            <div class="date_picker_item">
                                                <input type="text" class="dashboard-form-control datepicker input-lg" placeholder="Arrival Date" name="location_dater_arr" value="" autocomplete="off" id="location_datel_arr">
                                                <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 col-lg-3">
                                        <div class="form-group frm-grp">
                                            <label class="mr-b-10">Arrival Time (HH:MM)</label>
                                            <input type="time" class="dashboard-form-control input-lg" placeholder="Arrival Time" name="location_dater_arrtime" value="<?php if ($trip) echo $trip->trip_location_dater_arrtime; ?>" autocomplete="off" id="location_datel_arrtime">
                                        </div>
                                    </div>
                                </div>

                                <?php if ($transport != 'vehicle') { ?>
                                    <div class="seat_number_collapse_sec accordion2">
                                        <i class="fa fa-angle-down accordion-toggle2 active"></i>

                                        <div class="accordion-content default">
                                            <div class="row">
                                                <div class="col-md-12 col-lg-4">
                                                    <div class="form-group frm-grp">
                                                        <label class="mr-b-10"><?php echo $label; ?> Number</label>
                                                        <input type="text" class="dashboard-form-control input-lg" placeholder="<?php echo $label; ?> Number" name="ret_flight_no" id="ret_flight_no" value="<?php if ($trip) echo $trip->trip_ret_flight_no; ?>" autocomplete="off">
                                                    </div>
                                                </div>
                                                <div class="col-md-12 col-lg-4">
                                                    <div class="form-group frm-grp">
                                                        <label class="mr-b-10">Seat Number</label>
                                                        <input type="text" class="dashboard-form-control input-lg" placeholder="Seat Number" name="ret_seat_no" id="ret_seat_no" value="<?php if ($trip) echo $trip->trip_ret_seat_no; ?>" autocomplete="off">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <?php } ?>
                            </div>
                            <div class="row" id="waypts_div" style="display: none;">
                                <div class="col-xl-6 col-lg-6">
                                    <div class="add_stop_list_sec">
                                        <div class="accordion_container_item">
                                            <div class="set set0">
                                                <div class="close_item"><i class="fa fa-times" aria-hidden="true"></i></div>
                                                <a href="javascript:void(0)" onclick="collapse(this, 0)">
                                                    Stop 01
                                                    <i class="fa fa-angle-down"></i>
                                                </a>
                                                <div class="content content0">
                                                    <div class="accordion_container_item_first">
                                                        <div class="row">
                                                            <div class="col-xl-12 col-lg-12">
                                                                <div class="form-group">
                                                                    <label>Destination</label>
                                                                    <input type="text" onfocus="onWayPointKeyUp(this)" id="multi_location_waypoint0" name="multi_location_waypoint[]" class="form-control" placeholder="Destination">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xl-6 col-lg-6">
                                                                <div class="form-group">
                                                                    <label>Arrival Date</label>
                                                                    <div class="date_picker_item">
                                                                        <input type="text" name="multi_location_waypoint_date[]" class="form-control datepicker" id="multi_location_waypoint_date0" placeholder="Arrival Date">
                                                                        <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-xl-6 col-lg-6">
                                                                <div class="form-group">
                                                                    <label>Date of Departure</label>
                                                                    <div class="date_picker_item">
                                                                        <input type="text" name="multi_location_waypoint_dep_date[]" class="form-control datepicker" id="multi_location_waypoint_dep_date0" placeholder="Date of Departure">
                                                                        <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <?php if ($transport != 'vehicle') { ?>
                                                        <div class="add_stop_flight_de">
                                                            <div class="add_stop_flight_de_item">
                                                                <div class="row">
                                                                    <div class="col-xl-6 col-lg-6">
                                                                        <div class="form-group">
                                                                            <label><?php echo $label; ?> Number</label>
                                                                            <div class="date_picker_item">
                                                                                <input type="text" name="multi_waypoint_flight_no[]" class="form-control" placeholder="<?php echo $label; ?> Number">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-xl-6 col-lg-6">
                                                                        <div class="form-group">
                                                                            <label>Seat Number</label>
                                                                            <input type="text" name="multi_waypoint_seat_no[]" class="form-control" placeholder="Seat Number">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    <?php } ?>
                                                    <div class="add_hotel_details_list">
                                                        <div class="add_hotel_details_items">
                                                            <div class="row">
                                                                <div class="col-xl-12">
                                                                    <label for="add_hotel_detail">
                                                                        <input type="checkbox" onclick="add_hotel_detail(this, 0)" id="add_hotel_detail0" />
                                                                        Add Hotel Details
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div id="add_hotel_detail_value0" style="display: none">
                                                                <div class="row">
                                                                    <div class="col-xl-12">
                                                                        <div class="form-group">
                                                                            <label>Hotel Name</label>
                                                                            <input type="text" name="" class="form-control" placeholder="Hotel Name">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-xl-12">
                                                                        <div class="form-group">
                                                                            <label>Hotel Address</label>
                                                                            <input type="text" name="" onfocus="onWayPointKeyUp(this)" id="multi_location_waypoint0_hotel_addr" class="form-control" placeholder="Hotel Address">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="add_rental_car_detai_sec">
                                                            <div class="row">
                                                                <div class="col-xl-12">
                                                                    <label for="add_rental_deta_check">
                                                                        <input type="checkbox" onclick="add_rental_detail(this, 0)" id="add_rental_deta_check0" />
                                                                        Add Rental Car Details
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div id="add_rental_deta_check_value0" style="display: none">
                                                                <div class="row">
                                                                    <div class="col-xl-12">
                                                                        <div class="form-group">
                                                                            <label>Rental Agency</label>
                                                                            <input type="text" name="" class="form-control" placeholder="Rental Agency">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-xl-12">
                                                                        <div class="form-group">
                                                                            <label>Rental Agency Address</label>
                                                                            <input type="text" name="" onfocus="onWayPointKeyUp(this)" id="multi_location_waypoint0_agency_addr" class="form-control" placeholder="Rental Agency Address">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="append_more_stop" class="accordion_container_item">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-6 col-lg-6">
                                    <div class="add_stop_item_add">
                                        <a href="javascript:void(0);" class="add_stop_btn" id="addMoreStop">Add Stop</a>
                                    </div>
                                </div>
                            </div>

                            <div class="row pt-4">
                                <h5 class="add-hotel-text col-lg-6 col-md-12 main-color">Add a hotel stay to final destination</h5>
                                <div class="checkbox checkbox-primary col-lg-6 col-md-12">
                                    <input name="checkbox-hotel" id="checkbox-hotel" type="checkbox">
                                    <label for="checkbox-hotel">
                                        Use same dates as above
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Hotel Name</label>
                                        <input type="text" name="hotel_name" id="hotel_name" class="dashboard-form-control input-lg" placeholder="Hotel Name" value="<?php if ($trip) echo $trip->trip_hotel_name; ?>">
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">

                                        <label class="mr-b-10">Date of Check in</label>
                                        <div class="date_picker_item">
                                            <input type="text" name="hotel_date_checkin" id="hotel_date_checkin" autocomplete="off" value="<?php if ($trip) echo $trip->trip_hotel_date_checkin; ?>" class="dashboard-form-control datepicker input-lg" placeholder="Date of Check in">

                                            <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Date of Check out</label>
                                        <div class="date_picker_item">
                                            <input type="text" name="hotel_date_checkout" id="hotel_date_checkout" class="dashboard-form-control datepicker input-lg" placeholder="Date of Check out" value="<?php if ($trip) echo $trip->trip_hotel_date_checkout; ?>">
                                            <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-lg-12 right-side-link" style="min-height: 46px;">
                                    <div class="checkbox checkbox-primary">
                                        <input name="hotel_located" id="hotel_located" type="checkbox">
                                        <label for="hotel_located">
                                            Located at Airport
                                        </label>
                                    </div>

                                    <div class="affiliate_link">
                                        <a href="https://tp.media/r?marker=311162&trs=171390&p=2076&u=https%3A%2F%2Fbooking.com" target="_blank">
                                            <p>
                                                Book a hotel room with <span>Booking.com</span>
                                            </p>
                                        </a>
                                    </div>

                                </div>
                                <div class="col-md-12 col-lg-12">
                                    <label class="mr-b-10">Hotel Address</label>

                                    <input type="text" rows="4" class="dashboard-form-control input-lg" placeholder="Enter Hotel Address" name="hotel_address" id="hotel_address" value='<?php if ($trip) echo $trip->trip_rental_agency_address; ?>' />

                                </div>
                            </div>
                            <div class="row pt-4">
                                <h5 class="col-lg-6 col-md-12 add-hotel-text main-color">Add a car rental to final destination</h5>
                                <div class="col-lg-6 col-md-12 checkbox checkbox-primary">
                                    <input name="checkbox-car-rental" id="checkbox-car-rental" type="checkbox">
                                    <label for="checkbox-car-rental">
                                        Use same dates as above
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Rental Agency</label>
                                        <input type="text" class="dashboard-form-control input-lg" placeholder="Rental Agency" value="<?php if ($trip) echo $trip->trip_rental_agency; ?>" name="rental_agency" id="rental_agency">
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group frm-grp">
                                        <label class="mr-b-10">Date of pick up</label>

                                        <div class="date_picker_item">
                                            <input type="text" name="rental_date_pick" id="rental_date_pick" class="dashboard-form-control datepicker input-lg" placeholder="Date of pick up" value="<?php if ($trip) echo $trip->trip_rental_date_pick; ?>">
                                            <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-3">
                                    <div class="form-group">
                                        <label class="mr-b-10">Date of drop off</label>
                                        <div class="date_picker_item">
                                            <input type="text" name="rental_date_drop" id="rental_date_drop" class="dashboard-form-control datepicker input-lg" placeholder="Date of drop off" value="<?php if ($trip) echo $trip->trip_rental_date_drop; ?>">
                                            <!-- <i class="fa fa-calendar" aria-hidden="true"></i> -->
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-lg-12 right-side-link" style="min-height: 46px;">
                                    <div class="checkbox checkbox-primary">
                                        <input name="rental_agency_located" id="rental_agency_located" type="checkbox">
                                        <label for="rental_agency_located">
                                            Located at Airport
                                        </label>
                                    </div>

                                    <div class="affiliate_link">
                                        <a href="https://tp.media/r?marker=311162&trs=171390&p=3814&u=https%3A%2F%2Frentalcars.com" target="_blank">
                                            <p>
                                                Get a car rental with <span>Rentalcars.com</span>
                                            </p>
                                        </a>
                                    </div>

                                </div>
                                <div class="col-md-12 col-lg-12">
                                    <label class="mr-b-10">Rental Agency Address</label>

                                    <input type="text" class="dashboard-form-control input-lg" placeholder="Rental Agency Address" name="rental_agency_address" id="rental_agency_address" value='<?php if ($trip) echo $trip->trip_rental_agency_address; ?>' />
                                </div>
                            </div>

                            <script src="<?php echo SITE; ?>js/node_modules/php-date-formatter/js/php-date-formatter.min.js"></script>
                            <script src="<?php echo SITE; ?>js/node_modules/jquery-mousewheel/jquery.mousewheel.js"></script>
                            <script src="<?php echo SITE; ?>js/node_modules/jquery.datetimepicker.js?v=3"></script>
                            <div class="row pt-4 add_tpo_portion_item_sec">
                                <?php if ($transport != 'vehicle') { ?>
                                    <div class="col-md-12">
                                        <div class="form-group mb-10">
                                            <label><a href="#" onclick="toggle_visibility('driving');" class="outline-btn">
                                                    <i class="mdi mdi-plus-circle-outline plus-icon color-black"></i>Add Driving Portion</a>
                                            </label>
                                        </div>

                                        <div id="driving" style="display:none;">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <input name="location_from_drivingportion" id="location_from_drivingportion" value="<?php if ($trip) echo $trip->trip_location_from_drivingportion; ?>" type="text" class="dashboard-form-control input-lg" placeholder="Driving Start">
                                                </div>
                                                <div class="col-md-6">
                                                    <input name="location_to_drivingportion" id="location_to_drivingportion" value="<?php if ($trip) echo $trip->trip_location_to_drivingportion; ?>" type="text" class="dashboard-form-control input-lg" placeholder="Driving Destination">
                                                </div>
                                                <input name="location_from_latlng_drivingportion" id="location_from_latlng_drivingportion" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_from_latlng_drivingportion; ?>">
                                                <input name="location_to_latlng_drivingportion" id="location_to_latlng_drivingportion" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_to_latlng_drivingportion; ?>">
                                            </div>
                                        </div>
                                    </div>
                                <?php } ?>
                                <?php if ($transport != 'plane') { ?>
                                    <div class="col-md-12">
                                        <div class="form-group mb-10">
                                            <label class="add_train_portion_heading"><a href="#" onclick="toggle_visibility('flight');" class="outline-btn">
                                                    <i class="mdi mdi-plus-circle-outline plus-icon color-black"></i>Add flight Portion</a></label>
                                            <div id="flight" style="display:none;">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <input name="location_from_flightportion" id="location_from_flightportion" value="<?php if ($trip) echo $trip->trip_location_from_flightportion; ?>" type="text" class="clearable dashboard-form-control input-lg" placeholder="Takeoff Location">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <input name="location_to_flightportion" id="location_to_flightportion" value="<?php if ($trip) echo $trip->trip_location_to_flightportion; ?>" type="text" class="dashboard-form-control input-lg" placeholder="Destination Location">
                                                    </div>
                                                    <input name="location_from_latlng_flightportion" id="location_from_latlng_flightportion" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_from_latlng_flightportion; ?>">
                                                    <input name="location_to_latlng_flightportion" id="location_to_latlng_flightportion" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_to_latlng_flightportion; ?>">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <?php } ?>
                                <?php if ($transport != 'train') { ?>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="add_train_portion_heading"><a href="#" onclick="toggle_visibility('train');" class="outline-btn">
                                                    <i class="mdi mdi-plus-circle-outline plus-icon color-black"></i>Add a Train Portion</a></label>
                                            <div id="train" style="display:none;">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <input name="location_from_trainportion" id="location_from_trainportion" value="<?php if ($trip) echo $trip->trip_location_from_trainportion; ?>" type="text" class="dashboard-form-control input-lg" placeholder="Takeoff Location">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <input name="location_to_trainportion" id="location_to_trainportion" value="<?php if ($trip) echo $trip->trip_location_to_trainportion; ?>" type="text" class="dashboard-form-control input-lg" placeholder="Destination Location">
                                                    </div>
                                                    <input name="location_from_latlng_trainportion" id="location_from_latlng_trainportion" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_from_latlng_trainportion; ?>">
                                                    <input name="location_to_latlng_trainportion" id="location_to_latlng_trainportion" class="inp1" type="hidden" value="<?php if ($trip) echo $trip->trip_location_to_latlng_trainportion; ?>">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <?php } ?>
                            </div>

                            <div class="row">
                                <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 pt-5px">
                                    <!--<div class="form-group frm-grp">-->


                                    <a href="<?php echo SITE; ?>trip/origin-destination/<?php echo $transport; ?>" class="finish-next-btn">Clear All</a>
                                    <!--</div>-->
                                </div>
                                <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8 text-right pt-10px">
                                    <a href="" class="skip-note-btn float-none mobile_skip">Skip Section</a>
                                    <input name="location_submit" type="submit" id="location_submit" value="Create Trip" class="save-event-btn ml-3">
                                </div>
                            </div>




                        </form>

                    </fieldset>




                </div>


            </div>
        </div>

    </div>
    <br clear="all" />
    <div id="map"></div>

    <script>
        var transportWay = '<?php echo $transport; ?>';
    </script>
    <script>
        let offersRequest = null;
        let offersList = [];
        let offerData = null;
        let next_page = null;
        let previous_page = null;
        let off_id = null;
        let payment_intent_id = null;

        //stripe code

        $('input[type=radio][name=action_option_value]').change(function() {
            if (this.value == 'book') {
                $('#build_place').hide();
                $('#booking_place').delay(500).fadeIn();

            } else {
                $('#booking_place').hide();
                $('#build_place').delay(500).fadeIn();
            }
        });


        $('input[type=radio][name=trip_style]').change(function() {
            if (this.value == 'one') {
                $('#return_flight_section').hide();
            } else {
                $('#return_flight_section').delay(500).fadeIn();
            }
        });


        $('#step_sort').on('change', function(e) {
            var optionSelected = $(this).val();
            $('#steps').val(optionSelected);
            $("#flight_initial_form").submit();

            // var trip_mode = $("input[name='trip_style']:checked").val();
            // var sorts = $("#sorts").val();
            // var dataSet = 'request_id=' + offersRequest + '&trip_mode=' + trip_mode + '&steps=' + optionSelected + '&sorts=' + sorts;
            // ajaxLoad(dataSet);

        });

        $('#list_sort').on('change', function(e) {
            var optionSelected = $(this).val();
            $('#sorts').val(optionSelected);

            var trip_mode = $("input[name='trip_style']:checked").val();
            var steps = $("#steps").val();
            var dataSet = 'request_id=' + offersRequest + '&trip_mode=' + trip_mode + '&steps=' + steps + '&sorts=' + optionSelected;

            ajaxLoad(dataSet);

        });


        function timeFormat(dt) {
            return moment(dt).format("hh:mm a")
        }

        function timeDuration(dt) {
            var hour = moment(dt, "HH:mm").format("h");
            var minute = moment(dt, "HH:mm").format("mm");

            return hour + 'h ' + minute + 'm';
        }

        function layover(value) {
            var message;
            switch (value) {
                case 1:
                    message = 'Direct';
                    break;
                case 2:
                    message = '1 Stop';
                    break;
                case 3:
                    message = '2 Stop';
                    break;
                case 4:
                    message = '3 Stop';
                    break;
                default:
                    message = 'Direct';
            }

            return message;
        }


        function oneWayCalculation(slices) {
            console.log('slices', slices);

            var segment_count = slices[0].segments.length;
            var segment_index = (segment_count - 1);

            var items = "";
            items += `
            <div class="flight_heading">
                            <div class="flight_destination">
                                <h4>
                                    <i class="fa fa-plane"></i> Flight to ` + slices[0].destination.name + `
                                </h4>

                                <div class="flight_fact">
                                ` + timeFormat(slices[0].segments[0].departing_at) + ` - ` + timeFormat(slices[0].segments[segment_index].arriving_at) + `
                                </div>

                                <div class="flight_fact">
                                ` + timeDuration(slices[0].duration) + ` (` + layover(segment_count) + `)
                                </div>
                            </div>
                        </div>
            `;


            items += `<ul class="flight_spot">`;
            $.each(slices[0].segments, function(index, item) {
                items += `
                    <li>` + item.destination.name + `</li>
                            <p>` + timeDuration(item.duration) + ` flight</p>
                            <p>` + item.operating_carrier.name + ` - ` + item.operating_carrier_flight_number + `</p>
                            <p>` + item.passengers[0].cabin_class_marketing_name + `</p>
                `
            });

            items += `</ul>`;

            $(".flight_timeline").html(items);
        }

        function roundTripCalculation(slices) {
            console.log('slices', slices);

            var segment_count = slices[0].segments.length;
            var segment_index = (segment_count - 1);

            var items = "";
            items += `
            <div class="flight_heading">
                            <div class="flight_destination">
                                <h4>
                                    <i class="fa fa-plane"></i> Flight to ` + slices[0].destination.name + `
                                </h4>

                                <div class="flight_fact">
                                ` + timeFormat(slices[0].segments[0].departing_at) + ` - ` + timeFormat(slices[0].segments[segment_index].arriving_at) + `
                                </div>

                                <div class="flight_fact">
                                ` + timeDuration(slices[0].duration) + ` (` + layover(segment_count) + `)
                                </div>
                            </div>
                        </div>
            `;


            items += `<ul class="flight_spot">`;
            $.each(slices[0].segments, function(index, item) {
                items += `
                    <li>` + item.destination.name + `</li>
                            <p>` + timeDuration(item.duration) + ` flight</p>
                            <p>` + item.operating_carrier.name + ` - ` + item.operating_carrier_flight_number + `</p>
                            <p>` + item.passengers[0].cabin_class_marketing_name + `</p>
                `
            });

            items += `</ul>`;


            items += `
            <div class="flight_heading">
                            <div class="flight_destination">
                                <h4>
                                    <i class="fa fa-plane"></i> Flight to ` + slices[1].destination.name + `
                                </h4>

                                <div class="flight_fact">
                                ` + timeFormat(slices[1].segments[0].departing_at) + ` - ` + timeFormat(slices[1].segments[segment_index].arriving_at) + `
                                </div>

                                <div class="flight_fact">
                                ` + timeDuration(slices[1].duration) + ` (` + layover(segment_count) + `)
                                </div>
                            </div>
                        </div>
            `;

            items += `<ul class="flight_spot">`;
            $.each(slices[1].segments, function(index, item) {
                items += `
                    <li>` + item.destination.name + `</li>
                            <p>` + timeDuration(item.duration) + ` flight</p>
                            <p>` + item.operating_carrier.name + ` - ` + item.operating_carrier_flight_number + `</p>
                            <p>` + item.passengers[0].cabin_class_marketing_name + `</p>
                `
            });

            items += `</ul>`;

            $(".flight_timeline").html(items);
        }


        $(document).on('click', '.flight-item', function(event) {
            var offerID = $(this).data("offer-id");
            var trip_mode = $("input[name='trip_style']:checked").val();

            console.log('trip_mode', trip_mode);

            const matchValue = offersList.findIndex(item => item.id == offerID);

            offerData = offersList[matchValue];

            console.log('offerData', offerData);

            $('.traveller_container').hide();
            $('.message_container').hide();
            $('.action_container').hide();
            $('#traveler_inputs').html('');

            $('#master_modal').modal('show');

            if (trip_mode == 'one') {
                oneWayCalculation(offerData.slices);
            } else {
                roundTripCalculation(offerData.slices);
            }

            $('.payment_loading_screen').show();
            $('.payment_container').hide();

            var dataSet = 'offer_id=' + offerData.id;

            $.ajax({
                url: SITE + "process/api/paymentSingleOfferProcessing.php",
                type: "GET",
                data: dataSet,
                dataType: 'json',
                success: function(response) {
                    console.log('response', response);

                    $('.payment_loading_screen').hide();
                    $('.payment_container').show();

                    $('#amount_target').html('$' + response.data.total_amount);

                    off_id = response.data.offer_id;
                    payment_intent_id = response.data.payment_id;

                    DuffelComponents.renderCardPaymentComponent('payment_target', {
                        duffelPaymentIntentClientToken: response.data.client_token,
                        successfulPaymentHandler: successfulPaymentHandler, // Show 'successful payment' page and confirm Duffel PaymentIntent
                        errorPaymentHandler: errorPaymentHandlerFn // Show error page
                    });


                },
                error: function(jqXHR, textStatus, errorThrown) {
                    var res = jqXHR.responseJSON;

                    $('.payment_loading_screen').hide();
                    $('.message_container').show();
                    $('.response-message').html('<p class="warn">' + res.message + '</p>');
                }


            });




        });


        $("#order-form-complete").validate({
            rules: {
                'travels_title[]': {
                    required: true,
                },
                'travels_gender[]': {
                    required: true,
                },
                'travels_dob[]': {
                    required: true,
                },
                'travels_name[]': {
                    required: true,
                    minlength: 2
                },
                'travels_family_name[]': {
                    required: true,
                    minlength: 2
                },
                'travels_email[]': {
                    required: true,
                    email: true
                },
                'travels_number[]': {
                    required: true,
                    phoneUS: true
                },
                'countryCode[]': {
                    required: true,
                },
            },

            submitHandler: function(form) {

                $('.flight_booking').css('cursor', 'wait');
                $('.flight_booking').attr('disabled', true);

                $.ajax({
                    url: SITE + 'process/api/booking_complete_process.php',
                    type: "POST",
                    data: $(form).serialize() + '&offersRequest=' + offersRequest + '&off_id=' + off_id + '&payment_intent_id=' + payment_intent_id + '&check=' + SITE + '&date=' + new Date(),
                    dataType: 'json',
                    success: function(response) {

                        console.log('order-response', response);
                        console.log('order-response-id', response.id);

                        $('.traveller_container').hide();
                        $('.message_container').show();
                        $('.response-message').html('<p>Your Booking reference is : ' + response.id + '</p>');

                        $('.flight_booking').css('cursor', 'pointer');
                        $('.flight_booking').removeAttr('disabled');


                        $('#results_count').html('0');
                        $('#search_result').html('');
                        $('#search_result_section').hide();
                        $('.loading_screen').show();
                        $('.result-actions').hide();
                        $('.flight_load_more').hide();

                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        var res = jqXHR.responseJSON;

                        console.log('jqXHR', jqXHR);
                        console.log('res', res);
                        var error_items = "<p><ul>";

                        if (jqXHR.responseJSON.errors) {
                            $.each(jqXHR.responseJSON.errors, function(prefix, val) {
                                console.log('prefix', prefix);
                                console.log('val', val);
                                //$(form).find('label.' + prefix + '_error').html(val[0]).show();
                                error_items += "<li>" + val.message + "</li>";
                            });

                            error_items += "</ul></p>";

                            $('.response-message').html(error_items);
                        }

                        $('.traveller_container').hide();
                        $('.message_container').show();
                        $('.action_container').show();


                        $('.flight_booking').css('cursor', 'pointer');
                        $('.flight_booking').removeAttr('disabled');
                    }

                });



            }, // Do not change code below
            errorPlacement: function(error, element) {
                //error.insertAfter(element.parent());
            }


        });


        $('.try_again').click(function() {

            $('.traveller_container').show();
            //$('.message_container').show();
            $('.action_container').hide();

        });



        function successfulPaymentHandler() {
            var dataSet = 'intent_id=' + payment_intent_id + '&check=' + SITE + '&date=' + new Date();

            $.ajax({
                url: SITE + 'process/api/payment_confirm_process.php',
                type: "POST",
                data: dataSet,
                dataType: 'json',
                success: function(response) {

                    console.log('response_confirm', response);

                    swal({
                        title: "Payment process successfully done",
                        type: "success",
                        timer: 2500,
                        showConfirmButton: false,
                        customClass: 'swal-height'
                    });

                    $('.payment_container').hide();
                    $('.traveller_container').show();
                    travalers_input_populate(offerData.passengers);

                    $('.datepicker_two').datepicker(datePickerOptions)

                    //$('.payment_field').val('');

                    //card.clear();


                    //$("#payment-form").trigger("reset");

                    // var getValue = response.substring(12);

                    // var response_brought = response.indexOf('successfully');
                    // var response = response.indexOf('failed');
                    // if (response_brought != -1) {

                    //     alert(getValue);

                    // } else {


                    // }


                    // $('.stripe_process').css('cursor', 'pointer');
                    // $('.stripe_process').removeAttr('disabled');

                }

            });


        }

        function errorPaymentHandlerFn() {

            swal({
                title: "Payment process failed",
                type: "warning",
                timer: 2500,
                showConfirmButton: false,
                customClass: 'swal-height'
            });

        }


        function travalers_input_populate(TData) {

            var item_input = "";


            $.each(TData, function(index, item) {

                item_input += `            <p>Traveler  ` + (index + 1) + ` : ` + item.type + `</p>
                                                <div class="row mb-1 pay-row">
                                                    <div class="col-xl-4 col-12 padding_left">
                                                        <div class="form_group ">
                                                            <label>Title</label>
                                                            <select class="form-control extra-option-complete" name="travels_title[]">
                                                                <option value="mr">Mr.</option>
                                                                <option value="ms">Ms.</option>
                                                                <option value="mrs">Mrs.</option>
                                                                <option value="miss">Miss</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-4 col-12">
                                                        <div class="form_group">
                                                            <label>Gender</label>
                                                            <select class="form-control extra-option-complete" name="travels_gender[]">
                                                                <option value="m">Male</option>
                                                                <option value="f">Female</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-4 col-12">
                                                        <div class="form_group">
                                                            <label>DOB</label>
                                                            <input type="text" name="travels_dob[]" id="travels_dob_` + index + `" class="form-control datepicker_two extra-option-complete payment_field" placeholder="Date" require>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row mb-1 pay-row">
                                                    <div class="col-xl-6 col-12 padding_left">
                                                        <div class="form_group">
                                                            <label>Given name</label>
                                                            <input type="text" name="travels_name[]" id="travels_name_` + index + `" class="form-control extra-option-complete payment_field" placeholder="Enter Name" require>
                                                        </div>
                                                    </div>

                                                    <div class="col-xl-6 col-12 padding_left">
                                                        <div class="form_group">
                                                            <label>Family name</label>
                                                            <input type="text" name="travels_family_name[]" id="travels_family_name_` + index + `" class="form-control extra-option-complete payment_field" placeholder="Enter Family Name" require>
                                                        </div>
                                                    </div>

                                                </div>


                                                <div class="row mb-1 pay-row">
                                                    <div class="col-xl-12 col-12 padding_left">
                                                        <div class="form_group">
                                                            <label>Email</label>
                                                            <input type="email" name="travels_email[]" id="travels_email_` + index + `" class="form-control extra-option-complete payment_field" placeholder="Enter Email" require>
                                                        </div>
                                                    </div>

                                                    <div class="col-xl-6 col-12 padding_left">
                                                        <div class="form_group">
                                                            <label>Country Code</label>
                                                                                                                                                                            
                                                        <select name="countryCode[]" class="form-control extra-option-complete">                                                        
                                                        <option data-countryCode="US" value="+1" Selected>USA (+1)</option>
                                                        <option data-countryCode="GB" value="+44" >UK (+44)</option>
                                                        <optgroup label="Other countries">
                                                            <option data-countryCode="DZ" value="+213">Algeria (+213)</option>
                                                            <option data-countryCode="AD" value="+376">Andorra (+376)</option>
                                                            <option data-countryCode="AO" value="+244">Angola (+244)</option>
                                                            <option data-countryCode="AI" value="+1264">Anguilla (+1264)</option>
                                                            <option data-countryCode="AG" value="+1268">Antigua &amp; Barbuda (+1268)</option>
                                                            <option data-countryCode="AR" value="+54">Argentina (+54)</option>
                                                            <option data-countryCode="AM" value="+374">Armenia (+374)</option>
                                                            <option data-countryCode="AW" value="+297">Aruba (+297)</option>
                                                            <option data-countryCode="AU" value="+61">Australia (+61)</option>
                                                            <option data-countryCode="AT" value="+43">Austria (+43)</option>
                                                            <option data-countryCode="AZ" value="+994">Azerbaijan (+994)</option>
                                                            <option data-countryCode="BS" value="+1242">Bahamas (+1242)</option>
                                                            <option data-countryCode="BH" value="+973">Bahrain (+973)</option>
                                                            <option data-countryCode="BD" value="+880">Bangladesh (+880)</option>
                                                            <option data-countryCode="BB" value="+1246">Barbados (+1246)</option>
                                                            <option data-countryCode="BY" value="+375">Belarus (+375)</option>
                                                            <option data-countryCode="BE" value="+32">Belgium (+32)</option>
                                                            <option data-countryCode="BZ" value="+501">Belize (+501)</option>
                                                            <option data-countryCode="BJ" value="+229">Benin (+229)</option>
                                                            <option data-countryCode="BM" value="+1441">Bermuda (+1441)</option>
                                                            <option data-countryCode="BT" value="+975">Bhutan (+975)</option>
                                                            <option data-countryCode="BO" value="+591">Bolivia (+591)</option>
                                                            <option data-countryCode="BA" value="+387">Bosnia Herzegovina (+387)</option>
                                                            <option data-countryCode="BW" value="+267">Botswana (+267)</option>
                                                            <option data-countryCode="BR" value="+55">Brazil (+55)</option>
                                                            <option data-countryCode="BN" value="+673">Brunei (+673)</option>
                                                            <option data-countryCode="BG" value="+359">Bulgaria (+359)</option>
                                                            <option data-countryCode="BF" value="+226">Burkina Faso (+226)</option>
                                                            <option data-countryCode="BI" value="+257">Burundi (+257)</option>
                                                            <option data-countryCode="KH" value="+855">Cambodia (+855)</option>
                                                            <option data-countryCode="CM" value="+237">Cameroon (+237)</option>
                                                            <option data-countryCode="CA" value="+1">Canada (+1)</option>
                                                            <option data-countryCode="CV" value="+238">Cape Verde Islands (+238)</option>
                                                            <option data-countryCode="KY" value="+1345">Cayman Islands (+1345)</option>
                                                            <option data-countryCode="CF" value="+236">Central African Republic (+236)</option>
                                                            <option data-countryCode="CL" value="+56">Chile (+56)</option>
                                                            <option data-countryCode="CN" value="+86">China (+86)</option>
                                                            <option data-countryCode="CO" value="+57">Colombia (+57)</option>
                                                            <option data-countryCode="KM" value="+269">Comoros (+269)</option>
                                                            <option data-countryCode="CG" value="+242">Congo (+242)</option>
                                                            <option data-countryCode="CK" value="+682">Cook Islands (+682)</option>
                                                            <option data-countryCode="CR" value="+506">Costa Rica (+506)</option>
                                                            <option data-countryCode="HR" value="+385">Croatia (+385)</option>
                                                            <option data-countryCode="CU" value="+53">Cuba (+53)</option>
                                                            <option data-countryCode="CY" value="+90392">Cyprus North (+90392)</option>
                                                            <option data-countryCode="CY" value="+357">Cyprus South (+357)</option>
                                                            <option data-countryCode="CZ" value="+42">Czech Republic (+42)</option>
                                                            <option data-countryCode="DK" value="+45">Denmark (+45)</option>
                                                            <option data-countryCode="DJ" value="+253">Djibouti (+253)</option>
                                                            <option data-countryCode="DM" value="+1809">Dominica (+1809)</option>
                                                            <option data-countryCode="DO" value="+1809">Dominican Republic (+1809)</option>
                                                            <option data-countryCode="EC" value="+593">Ecuador (+593)</option>
                                                            <option data-countryCode="EG" value="+20">Egypt (+20)</option>
                                                            <option data-countryCode="SV" value="+503">El Salvador (+503)</option>
                                                            <option data-countryCode="GQ" value="+240">Equatorial Guinea (+240)</option>
                                                            <option data-countryCode="ER" value="+291">Eritrea (+291)</option>
                                                            <option data-countryCode="EE" value="+372">Estonia (+372)</option>
                                                            <option data-countryCode="ET" value="+251">Ethiopia (+251)</option>
                                                            <option data-countryCode="FK" value="+500">Falkland Islands (+500)</option>
                                                            <option data-countryCode="FO" value="+298">Faroe Islands (+298)</option>
                                                            <option data-countryCode="FJ" value="+679">Fiji (+679)</option>
                                                            <option data-countryCode="FI" value="+358">Finland (+358)</option>
                                                            <option data-countryCode="FR" value="+33">France (+33)</option>
                                                            <option data-countryCode="GF" value="+594">French Guiana (+594)</option>
                                                            <option data-countryCode="PF" value="+689">French Polynesia (+689)</option>
                                                            <option data-countryCode="GA" value="+241">Gabon (+241)</option>
                                                            <option data-countryCode="GM" value="+220">Gambia (+220)</option>
                                                            <option data-countryCode="GE" value="+7880">Georgia (+7880)</option>
                                                            <option data-countryCode="DE" value="+49">Germany (+49)</option>
                                                            <option data-countryCode="GH" value="+233">Ghana (+233)</option>
                                                            <option data-countryCode="GI" value="+350">Gibraltar (+350)</option>
                                                            <option data-countryCode="GR" value="+30">Greece (+30)</option>
                                                            <option data-countryCode="GL" value="+299">Greenland (+299)</option>
                                                            <option data-countryCode="GD" value="+1473">Grenada (+1473)</option>
                                                            <option data-countryCode="GP" value="+590">Guadeloupe (+590)</option>
                                                            <option data-countryCode="GU" value="+671">Guam (+671)</option>
                                                            <option data-countryCode="GT" value="+502">Guatemala (+502)</option>
                                                            <option data-countryCode="GN" value="+224">Guinea (+224)</option>
                                                            <option data-countryCode="GW" value="+245">Guinea - Bissau (+245)</option>
                                                            <option data-countryCode="GY" value="+592">Guyana (+592)</option>
                                                            <option data-countryCode="HT" value="+509">Haiti (+509)</option>
                                                            <option data-countryCode="HN" value="+504">Honduras (+504)</option>
                                                            <option data-countryCode="HK" value="+852">Hong Kong (+852)</option>
                                                            <option data-countryCode="HU" value="+36">Hungary (+36)</option>
                                                            <option data-countryCode="IS" value="+354">Iceland (+354)</option>
                                                            <option data-countryCode="IN" value="+91">India (+91)</option>
                                                            <option data-countryCode="ID" value="+62">Indonesia (+62)</option>
                                                            <option data-countryCode="IR" value="+98">Iran (+98)</option>
                                                            <option data-countryCode="IQ" value="+964">Iraq (+964)</option>
                                                            <option data-countryCode="IE" value="+353">Ireland (+353)</option>
                                                            <option data-countryCode="IL" value="+972">Israel (+972)</option>
                                                            <option data-countryCode="IT" value="+39">Italy (+39)</option>
                                                            <option data-countryCode="JM" value="+1876">Jamaica (+1876)</option>
                                                            <option data-countryCode="JP" value="+81">Japan (+81)</option>
                                                            <option data-countryCode="JO" value="+962">Jordan (+962)</option>
                                                            <option data-countryCode="KZ" value="+7">Kazakhstan (+7)</option>
                                                            <option data-countryCode="KE" value="+254">Kenya (+254)</option>
                                                            <option data-countryCode="KI" value="+686">Kiribati (+686)</option>
                                                            <option data-countryCode="KP" value="+850">Korea North (+850)</option>
                                                            <option data-countryCode="KR" value="+82">Korea South (+82)</option>
                                                            <option data-countryCode="KW" value="+965">Kuwait (+965)</option>
                                                            <option data-countryCode="KG" value="+996">Kyrgyzstan (+996)</option>
                                                            <option data-countryCode="LA" value="+856">Laos (+856)</option>
                                                            <option data-countryCode="LV" value="+371">Latvia (+371)</option>
                                                            <option data-countryCode="LB" value="+961">Lebanon (+961)</option>
                                                            <option data-countryCode="LS" value="+266">Lesotho (+266)</option>
                                                            <option data-countryCode="LR" value="+231">Liberia (+231)</option>
                                                            <option data-countryCode="LY" value="+218">Libya (+218)</option>
                                                            <option data-countryCode="LI" value="+417">Liechtenstein (+417)</option>
                                                            <option data-countryCode="LT" value="+370">Lithuania (+370)</option>
                                                            <option data-countryCode="LU" value="+352">Luxembourg (+352)</option>
                                                            <option data-countryCode="MO" value="+853">Macao (+853)</option>
                                                            <option data-countryCode="MK" value="+389">Macedonia (+389)</option>
                                                            <option data-countryCode="MG" value="+261">Madagascar (+261)</option>
                                                            <option data-countryCode="MW" value="+265">Malawi (+265)</option>
                                                            <option data-countryCode="MY" value="+60">Malaysia (+60)</option>
                                                            <option data-countryCode="MV" value="+960">Maldives (+960)</option>
                                                            <option data-countryCode="ML" value="+223">Mali (+223)</option>
                                                            <option data-countryCode="MT" value="+356">Malta (+356)</option>
                                                            <option data-countryCode="MH" value="+692">Marshall Islands (+692)</option>
                                                            <option data-countryCode="MQ" value="+596">Martinique (+596)</option>
                                                            <option data-countryCode="MR" value="+222">Mauritania (+222)</option>
                                                            <option data-countryCode="YT" value="+269">Mayotte (+269)</option>
                                                            <option data-countryCode="MX" value="+52">Mexico (+52)</option>
                                                            <option data-countryCode="FM" value="+691">Micronesia (+691)</option>
                                                            <option data-countryCode="MD" value="+373">Moldova (+373)</option>
                                                            <option data-countryCode="MC" value="+377">Monaco (+377)</option>
                                                            <option data-countryCode="MN" value="+976">Mongolia (+976)</option>
                                                            <option data-countryCode="MS" value="+1664">Montserrat (+1664)</option>
                                                            <option data-countryCode="MA" value="+212">Morocco (+212)</option>
                                                            <option data-countryCode="MZ" value="+258">Mozambique (+258)</option>
                                                            <option data-countryCode="MN" value="+95">Myanmar (+95)</option>
                                                            <option data-countryCode="NA" value="+264">Namibia (+264)</option>
                                                            <option data-countryCode="NR" value="+674">Nauru (+674)</option>
                                                            <option data-countryCode="NP" value="+977">Nepal (+977)</option>
                                                            <option data-countryCode="NL" value="+31">Netherlands (+31)</option>
                                                            <option data-countryCode="NC" value="+687">New Caledonia (+687)</option>
                                                            <option data-countryCode="NZ" value="+64">New Zealand (+64)</option>
                                                            <option data-countryCode="NI" value="+505">Nicaragua (+505)</option>
                                                            <option data-countryCode="NE" value="+227">Niger (+227)</option>
                                                            <option data-countryCode="NG" value="+234">Nigeria (+234)</option>
                                                            <option data-countryCode="NU" value="+683">Niue (+683)</option>
                                                            <option data-countryCode="NF" value="+672">Norfolk Islands (+672)</option>
                                                            <option data-countryCode="NP" value="+670">Northern Marianas (+670)</option>
                                                            <option data-countryCode="NO" value="+47">Norway (+47)</option>
                                                            <option data-countryCode="OM" value="+968">Oman (+968)</option>
                                                            <option data-countryCode="PW" value="+680">Palau (+680)</option>
                                                            <option data-countryCode="PA" value="+507">Panama (+507)</option>
                                                            <option data-countryCode="PG" value="+675">Papua New Guinea (+675)</option>
                                                            <option data-countryCode="PY" value="+595">Paraguay (+595)</option>
                                                            <option data-countryCode="PE" value="+51">Peru (+51)</option>
                                                            <option data-countryCode="PH" value="+63">Philippines (+63)</option>
                                                            <option data-countryCode="PL" value="+48">Poland (+48)</option>
                                                            <option data-countryCode="PT" value="+351">Portugal (+351)</option>
                                                            <option data-countryCode="PR" value="+1787">Puerto Rico (+1787)</option>
                                                            <option data-countryCode="QA" value="+974">Qatar (+974)</option>
                                                            <option data-countryCode="RE" value="+262">Reunion (+262)</option>
                                                            <option data-countryCode="RO" value="+40">Romania (+40)</option>
                                                            <option data-countryCode="RU" value="+7">Russia (+7)</option>
                                                            <option data-countryCode="RW" value="+250">Rwanda (+250)</option>
                                                            <option data-countryCode="SM" value="+378">San Marino (+378)</option>
                                                            <option data-countryCode="ST" value="+239">Sao Tome &amp; Principe (+239)</option>
                                                            <option data-countryCode="SA" value="+966">Saudi Arabia (+966)</option>
                                                            <option data-countryCode="SN" value="+221">Senegal (+221)</option>
                                                            <option data-countryCode="CS" value="+381">Serbia (+381)</option>
                                                            <option data-countryCode="SC" value="+248">Seychelles (+248)</option>
                                                            <option data-countryCode="SL" value="+232">Sierra Leone (+232)</option>
                                                            <option data-countryCode="SG" value="+65">Singapore (+65)</option>
                                                            <option data-countryCode="SK" value="+421">Slovak Republic (+421)</option>
                                                            <option data-countryCode="SI" value="+386">Slovenia (+386)</option>
                                                            <option data-countryCode="SB" value="+677">Solomon Islands (+677)</option>
                                                            <option data-countryCode="SO" value="+252">Somalia (+252)</option>
                                                            <option data-countryCode="ZA" value="+27">South Africa (+27)</option>
                                                            <option data-countryCode="ES" value="+34">Spain (+34)</option>
                                                            <option data-countryCode="LK" value="+94">Sri Lanka (+94)</option>
                                                            <option data-countryCode="SH" value="+290">St. Helena (+290)</option>
                                                            <option data-countryCode="KN" value="+1869">St. Kitts (+1869)</option>
                                                            <option data-countryCode="SC" value="+1758">St. Lucia (+1758)</option>
                                                            <option data-countryCode="SD" value="+249">Sudan (+249)</option>
                                                            <option data-countryCode="SR" value="+597">Suriname (+597)</option>
                                                            <option data-countryCode="SZ" value="+268">Swaziland (+268)</option>
                                                            <option data-countryCode="SE" value="+46">Sweden (+46)</option>
                                                            <option data-countryCode="CH" value="+41">Switzerland (+41)</option>
                                                            <option data-countryCode="SI" value="+963">Syria (+963)</option>
                                                            <option data-countryCode="TW" value="+886">Taiwan (+886)</option>
                                                            <option data-countryCode="TJ" value="+7">Tajikstan (+7)</option>
                                                            <option data-countryCode="TH" value="+66">Thailand (+66)</option>
                                                            <option data-countryCode="TG" value="+228">Togo (+228)</option>
                                                            <option data-countryCode="TO" value="+676">Tonga (+676)</option>
                                                            <option data-countryCode="TT" value="+1868">Trinidad &amp; Tobago (+1868)</option>
                                                            <option data-countryCode="TN" value="+216">Tunisia (+216)</option>
                                                            <option data-countryCode="TR" value="+90">Turkey (+90)</option>
                                                            <option data-countryCode="TM" value="+7">Turkmenistan (+7)</option>
                                                            <option data-countryCode="TM" value="+993">Turkmenistan (+993)</option>
                                                            <option data-countryCode="TC" value="+1649">Turks &amp; Caicos Islands (+1649)</option>
                                                            <option data-countryCode="TV" value="+688">Tuvalu (+688)</option>
                                                            <option data-countryCode="UG" value="+256">Uganda (+256)</option>        
                                                            <option data-countryCode="UA" value="+380">Ukraine (+380)</option>
                                                            <option data-countryCode="AE" value="+971">United Arab Emirates (+971)</option>
                                                            <option data-countryCode="UY" value="+598">Uruguay (+598)</option>        
                                                            <option data-countryCode="UZ" value="+7">Uzbekistan (+7)</option>
                                                            <option data-countryCode="VU" value="+678">Vanuatu (+678)</option>
                                                            <option data-countryCode="VA" value="+379">Vatican City (+379)</option>
                                                            <option data-countryCode="VE" value="+58">Venezuela (+58)</option>
                                                            <option data-countryCode="VN" value="+84">Vietnam (+84)</option>
                                                            <option data-countryCode="VG" value="+84">Virgin Islands - British (+1284)</option>
                                                            <option data-countryCode="VI" value="+84">Virgin Islands - US (+1340)</option>
                                                            <option data-countryCode="WF" value="+681">Wallis &amp; Futuna (+681)</option>
                                                            <option data-countryCode="YE" value="+969">Yemen (North)(+969)</option>
                                                            <option data-countryCode="YE" value="+967">Yemen (South)(+967)</option>
                                                            <option data-countryCode="ZM" value="+260">Zambia (+260)</option>
                                                            <option data-countryCode="ZW" value="+263">Zimbabwe (+263)</option>
                                                        </optgroup>
                                                    </select>
                                                     </div>
                                                    </div>                                                    

                                                    <div class="col-xl-6 col-12 padding_left">
                                                        <div class="form_group">
                                                            <label>Phone number</label>
                                                            <input type="text" name="travels_number[]" id="travels_number_` + index + `" class="form-control extra-option-complete payment_field" placeholder="Enter Number" require>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" name="travels_type[]" value="` + item.type + `" readonly>
                                                    <input type="hidden" name="travels_id[]" value="` + item.id + `" readonly>
                                                </div>
            
            `;

            });

            $("#traveler_inputs").html(item_input);

        }



        let pas = [{
                "type": "adult",
                "loyalty_programme_accounts": [],
                "id": "pas_0000ALDZniJTjcpjOqFzMo",
                "given_name": null,
                "family_name": null,
                "age": null
            },
            {
                "type": "child",
                "loyalty_programme_accounts": [],
                "id": "pas_0000ALDZniJTjcpjOqFzMp",
                "given_name": null,
                "family_name": null,
                "age": null
            },
            {
                "type": "infant_without_seat",
                "loyalty_programme_accounts": [],
                "id": "pas_0000ALDZniJTjcpjOqFzMq",
                "given_name": null,
                "family_name": null,
                "age": null
            }
        ];

        $('#master_modal_click').on('click', function(e) {
            $('#master_modal').modal('hide');
        });

        //$('.traveller_container').show();
        //travalers_input_populate(pas);


        const SITE_API = "https://www.planiversity.com/staging/flow/";
        const token = "duffel_test_ZgNwOQ6vA1oMHPy7r1UY5j5VI4xItZuwRKxOcpcsjMj";

        function airportDataFetch() {

            //$('#update_note').modal('show');

            var dataSet = 'id=' + "id";

            $.ajax({
                url: SITE + "process/api/airportData.php",
                type: "GET",
                //data: dataSet,            
                dataType: 'json',
                success: function(response) {
                    dataRendaring(response.data);
                }

            });

        }

        function dataRendaring(data) {
            var items = "";
            $.each(data, function(index, item) {
                items += "<div class='col-sm-4'> <div class='airport-result-wrap' id='airport_" + item.id + "'> <label class='control control--radio'> " + item.name + "  <input type='radio' name='airport_value'/><div class='control__indicator'></div></label> </div></div>";
            });

            $("#airport_list_place").html(items);
        }


        $('.input-button').click(function() {
            $('#airportsListModal').modal('show');
            airportDataFetch();
        });


        function formatRepo(repo) {
            if (repo.loading) return repo.name;
            var check_icon = null;
            if (repo.type == "city") {
                check_icon = "fa-map-marker";
            } else {
                check_icon = "fa-plane";
            }

            var markup = '<div class="markup-location"><div class="m-icon"><i class="fa ' + check_icon + '"></i></div><div class="m-content"><p>' + repo.name + '<span>' + repo.country_name + '</span></p></div></div>';

            return markup;


        }

        function formatRepoSelectionFrom(repo) {
            console.log('selected value', repo);
            $('#from_location_code').val(repo.iata_code);
            return repo.name;
        }

        function formatRepoSelectionTo(repo) {
            console.log('selected value', repo);
            $('#to_location_code').val(repo.iata_code);
            return repo.name;
        }



        $('#from_location').select2({
            ajax: {
                url: SITE + "process/api/airportDataProcessing.php",
                type: "POST",
                dataType: 'json',
                delay: 250,
                data: function(params) {
                    var query = {
                        query: params.term,
                        //type: 'public'
                    }
                    // Query parameters will be ?search=[term]&type=public
                    return query;
                },
                processResults: function(data, params) {
                    // parse the results into the format expected by Select2
                    // since we are using custom formatting functions we do not need to
                    // alter the remote JSON data, except to indicate that infinite
                    // scrolling can be used
                    params.page = params.page || 1;



                    return {
                        results: data.data,
                        pagination: {
                            more: (params.page * 30) < data.data.total_count
                        }
                    };
                },
                cache: true
            },
            escapeMarkup: function(markup) {
                return markup;
            },
            placeholder: 'Search for a repository',
            minimumInputLength: 2,
            templateResult: formatRepo,
            templateSelection: formatRepoSelectionFrom,
            allowClear: true,
            width: "100%",
            dropdownParent: $('#schedule-modal'),
            dropdownPosition: 'below'
        });




        $('#to_location').select2({
            ajax: {
                url: SITE + "process/api/airportDataProcessing.php",
                type: "POST",
                dataType: 'json',
                delay: 250,
                data: function(params) {
                    var query = {
                        query: params.term,
                        //type: 'public'
                    }
                    // Query parameters will be ?search=[term]&type=public
                    return query;
                },
                processResults: function(data, params) {
                    // parse the results into the format expected by Select2
                    // since we are using custom formatting functions we do not need to
                    // alter the remote JSON data, except to indicate that infinite
                    // scrolling can be used
                    params.page = params.page || 1;



                    return {
                        results: data.data,
                        pagination: {
                            more: (params.page * 30) < data.data.total_count
                        }
                    };
                },
                cache: true
            },
            escapeMarkup: function(markup) {
                return markup;
            },
            placeholder: 'Search for a location',
            minimumInputLength: 2,
            templateResult: formatRepo,
            templateSelection: formatRepoSelectionTo,
            allowClear: true,
            width: "100%",
            dropdownParent: $('#schedule-modal'),
            dropdownPosition: 'below'
        });


        // $('#flight_search').click(function() {

        //     $.ajax({
        //         url: SITE + "process/api/offerRequestProcessing.php",
        //         type: "POST",
        //         //data: dataSet,            
        //         dataType: 'json',
        //         success: function(response) {

        //             console.log(response);
        //             //dataRendaring(response.data);
        //         }

        //     });

        // });


        $.validator.addMethod("maxDate", function(value, element) {
            var curDate = new Date();
            var inputDate = new Date(value);
            if (inputDate < curDate)
                return true;
            return false;
        }, "Invalid Date!"); // error message

        $("#flight_initial_form").validate({
            ignore: ':hidden:not(.validy)',
            rules: {

                from_location_code: {
                    required: true,
                },
                to_location_code: {
                    required: true,
                },
                departure_flight_date: {
                    required: true,
                    date: true,
                    //maxDate: true
                },
                return_flight_date: {
                    required: true,
                    date: true,
                    //maxDate: true
                }
            },
            messages: {

                from_location_code: {
                    required: 'Please select origin airport'
                },
                to_location_code: {
                    required: 'Please select destination airport'
                },
                departure_flight_date: {
                    required: 'Please select departure date'
                },
                return_flight_date: {
                    required: 'Please select return date'
                }
            },

            submitHandler: function(form) {

                // $('.flight_search').css('cursor', 'wait');
                // $('.flight_search').attr('disabled', true);

                $('#results_count').html('0');
                $('#search_result').html('');
                $('#search_result_section').delay(200).fadeIn();
                $('.loading_screen').show();
                $('.result-actions').hide();
                $('.flight_load_more').hide();
                $('.target_action').attr('disabled', false);


                $.ajax({
                    url: SITE + "process/api/offerRequestProcessing.php",
                    type: "POST",
                    data: $(form).serialize(),
                    dataType: 'json',
                    success: function(response) {

                        console.log(response);
                        $('.loading_screen').hide();
                        $('#search_result').html(response.data.offerList);
                        $('#results_count').html(response.data.results);
                        offersList = [...response.data.offers];
                        offersRequest = response.data.offer_request_id;
                        next_page = response.data.next_page;
                        previous_page = response.data.previous_page;
                        $('#next_button').val(response.data.next_page);
                        $('#previous_button').val(response.data.previous_page);

                        if (response.data.results > 0) {
                            $('.result-actions').show();
                        }

                        if (next_page || previous_page) {
                            $('.flight_load_more').show();
                        }

                        if (next_page == null) {
                            $('#next_button').attr('disabled', true);
                        }

                        if (previous_page == null) {
                            $('#previous_button').attr('disabled', true);
                        }

                        console.log('offersList', offersList);
                        console.log('next_page', next_page);
                        console.log('previous_page', previous_page);




                        // $('.flight_search').css('cursor', 'pointer');
                        // $('.flight_search').removeAttr('disabled');


                    },
                    error: function(jqXHR, textStatus, errorThrown) {

                        // toastr.error('A system error has been encountered. Please try again');

                        // $('.update_submit_button').css('cursor', 'pointer');
                        // $('.update_submit_button').removeAttr('disabled');
                        // $('#update_note').modal('hide');

                    }




                });




            }, // Do not change code below
            errorPlacement: function(error, element) {
                error.insertAfter(element.parent());
            }


        });


        $(document).on('click', '.target_action', function(event) {
            var type = $(this).data("type");
            var targetValue = $(this).val();
            var steps = $("#steps").val();
            var sorts = $("#sorts").val();
            var trip_mode = $("input[name='trip_style']:checked").val();
            var dataSet = 'request_id=' + offersRequest + '&trip_mode=' + trip_mode + '&type=' + type + '&typeValue=' + targetValue + '&steps=' + steps + '&sorts=' + sorts;
            ajaxLoad(dataSet);
        });

        function ajaxLoad(dataSet) {

            $('#results_count').html('0');
            $('#search_result').html('');
            $('#search_result_section').delay(200).fadeIn();
            $('.loading_screen').show();
            $('.result-actions').hide();
            $('.flight_load_more').hide();
            $('.target_action').attr('disabled', false);


            $.ajax({
                url: SITE + "process/api/offerListProcessing.php",
                type: "GET",
                data: dataSet,
                dataType: 'json',
                success: function(response) {

                    $('.loading_screen').hide();
                    $('#search_result').html(response.data.offerList);
                    $('#results_count').html(response.data.results);
                    offersList = [...response.data.offers];
                    offersRequest = response.data.offer_request_id;
                    next_page = response.data.next_page;
                    previous_page = response.data.previous_page;
                    $('#next_button').val(response.data.next_page);
                    $('#previous_button').val(response.data.previous_page);

                    if (response.data.results > 0) {
                        $('.result-actions').show();
                    }

                    if (next_page || previous_page) {
                        $('.flight_load_more').show();
                    }


                    if (next_page == null) {
                        $('#next_button').attr('disabled', true);
                    }

                    if (previous_page == null) {
                        $('#previous_button').attr('disabled', true);
                    }


                }


            });
        }


        var body = $('body,html');
        var selectSpecial = $('#js-select-special');
        var info = selectSpecial.find('#info');
        var dropdownSelect = selectSpecial.parent().find('.dropdown-select');
        var listRoom = dropdownSelect.find('.list-room');
        var listChild = dropdownSelect.find('.child-list');
        var listInfant = dropdownSelect.find('.infant-list');
        var btnAddRoom = $('#btn-add-room');
        var totalRoom = 0;
        var totalInfant = 0;

        selectSpecial.on('click', function(e) {
            e.stopPropagation();
            $(this).toggleClass("open");
            dropdownSelect.toggleClass("show");
        });

        dropdownSelect.on('click', function(e) {
            e.stopPropagation();
        });

        body.on('click', function() {
            selectSpecial.removeClass("open");
            dropdownSelect.removeClass("show");
        });

        listRoom.on('click', '.a__plus', function() {
            var that = $(this);
            var qtyContainer = that.parent();
            var qtyInput = qtyContainer.find('input[type=number]');
            var oldValue = parseInt(qtyInput.val());
            var newVal = oldValue + 1;
            qtyInput.val(newVal);

            updateRoom();
        });

        listRoom.on('click', '.a__minus', function() {
            var that = $(this);
            var qtyContainer = that.parent();
            var qtyInput = qtyContainer.find('input[type=number]');
            var min = qtyInput.attr('min');

            var oldValue = parseInt(qtyInput.val());
            if (oldValue <= min) {
                var newVal = oldValue;
            } else {
                var newVal = oldValue - 1;
            }
            qtyInput.val(newVal);

            updateRoom();
        });


        listRoom.on('click', '.c__plus', function() {
            var that = $(this);
            var qtyContainer = that.parent();
            var qtyInput = qtyContainer.find('input[type=number]');
            var oldValue = parseInt(qtyInput.val());
            var newVal = oldValue + 1;
            qtyInput.val(newVal);
            add_children();
            updateRoom();
        });


        listRoom.on('click', '.c__minus', function() {
            var that = $(this);
            var qtyContainer = that.parent();
            var qtyInput = qtyContainer.find('input[type=number]');
            var min = qtyInput.attr('min');

            var oldValue = parseInt(qtyInput.val());
            if (oldValue <= min) {
                var newVal = oldValue;
            } else {
                var newVal = oldValue - 1;
            }
            qtyInput.val(newVal);
            $('.list-room .children-list:last').remove();
            totalRoom--;
            updateRoom();
        });



        function add_children() {

            totalRoom++;

            listChild.append('<li class="list-room__item children-list">' +
                '                                        <ul class="list-person children-person">' +
                '                                            <li class="list-person__item children-item">' +
                '                                                <span class="name">' +
                '                                                    Age of child ' + totalRoom + '' +
                '                                                </span>' +
                '                                                <div class="child-age-div">' +
                '                                                 <select class="child-age" name="children[]"><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option></select>' +
                '                                                </div>' +
                '                                            </li>' +
                '                                        </ul>');



        }



        listRoom.on('click', '.i__plus', function() {
            var that = $(this);
            var qtyContainer = that.parent();
            var qtyInput = qtyContainer.find('input[type=number]');
            var oldValue = parseInt(qtyInput.val());
            var newVal = oldValue + 1;
            qtyInput.val(newVal);
            add_infant();

            updateRoom();
        });


        listRoom.on('click', '.i__minus', function() {
            var that = $(this);
            var qtyContainer = that.parent();
            var qtyInput = qtyContainer.find('input[type=number]');
            var min = qtyInput.attr('min');

            var oldValue = parseInt(qtyInput.val());
            if (oldValue <= min) {
                var newVal = oldValue;
            } else {
                var newVal = oldValue - 1;
            }
            qtyInput.val(newVal);
            $('.list-room .infant-list:last').remove();
            totalInfant--;
            updateRoom();
        });


        function add_infant() {

            totalInfant++;

            listInfant.append('<li class="list-room__item infant-list">' +
                '                                        <ul class="list-person children-person">' +
                '                                            <li class="list-person__item children-item">' +
                '                                                <span class="name">' +
                '                                                    Age of infant ' + totalInfant + '' +
                '                                                </span>' +
                '                                                <div class="child-age-div">' +
                '                                                 <select class="child-age" name="infant[]"><option value="1" selected>1</option></select>' +
                '                                                </div>' +
                '                                            </li>' +
                '                                        </ul>');



        }


        function countAdult() {
            var listRoomItem = listRoom.find('.list-room__item');
            var totalAdults = 0;

            var numberAdults = parseInt(listRoomItem.find('.quantity1 > input').val());
            totalAdults = totalAdults + numberAdults;

            return totalAdults;
        }

        function countChildren() {
            var listRoomItem = listRoom.find('.list-room__item');
            var totalChildren = 0;

            var numberChildren = parseInt(listRoomItem.find('.quantity2 > input').val());

            totalChildren = totalChildren + numberChildren;


            return totalChildren;
        }


        function countInfant() {
            var listRoomItem = listRoom.find('.list-room__item');
            var totalNoInfant = 0;

            var numberInfant = parseInt(listRoomItem.find('.quantity3 > input').val());

            totalNoInfant = totalNoInfant + numberInfant;


            return totalNoInfant;
        }


        function updateRoom() {
            var totalAd = parseInt(countAdult());
            var totalChi = parseInt(countChildren());
            var totalInf = parseInt(countInfant());

            console.log('totalAd', totalAd);
            console.log('totalChi', totalChi);

            var adults = 'Adult, ';
            var rooms = 'Room';

            if (totalAd > 1) {
                adults = 'Adults, ';
            }

            if (totalRoom > 1) {
                rooms = 'Rooms';
            }

            var infoText = Number(totalAd + totalChi + totalInf);

            var infoText = infoText + ' Person ';

            info.val(infoText);
        }





        $(window).on('load', function() {
            $('#schedule-modal').modal('show');
        });
        $('#change-travel-method').change(function() {
            var mode = $('#change-travel-method').val();
            if (mode == 'vehicle') {
                window.location.href = "<?= SITE ?>trip/origin-destination/vehicle";
            } else if (mode == 'plane') {
                window.location.href = "<?= SITE ?>trip/origin-destination/plane";
            } else if (mode == 'train') {
                window.location.href = "<?= SITE ?>trip/origin-destination/train";
            } else {
                location.reload();
            }
        })
    </script>

    <script>
        var infowindow1 = null;
        var marker_origin = null;
        var marker_destination = null;
        var flightPath = null;

        var map = null;
        var bounds = null;
        var directionsService = null;
        var directionsRenderer = null;
        var waypoints = [];

        function initMap() {
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                draggable: true,
                polylineOptions: {
                    strokeColor: "#0688E9"
                },
                suppressMarkers: true
            });
            map = new google.maps.Map(document.getElementById('map'), {
                mapTypeControl: false,
                center: {
                    lat: 40.730610,
                    lng: -73.968285
                },
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                zoom: 7
            });
            directionsRenderer.setMap(map);
            if (transportWay === 'plane') {
                // drawing line
                new DrawPlaneDirectionsHandler(map);
            } else {
                // tracing the route
                new AutocompleteDirectionsHandler(map);
            }


            var hotel_address = document.getElementById('hotel_address');
            var hotelAddressPlaceAutocomplete = new google.maps.places.Autocomplete(hotel_address);

            var rental_agency_address = document.getElementById('rental_agency_address');
            var rentalAgencyAddressPlaceAutocomplete = new google.maps.places.Autocomplete(rental_agency_address);


        }


        function DrawPlaneDirectionsHandler(map) {
            this.map = map;
            this.originPlaceId = this.origin_dportionPlaceId = null;
            this.destinationPlaceId = this.destination_dportionPlaceId = null;
            this.originPlaceLocation = this.origin_dportionPlaceLocation = null;
            this.destinationPlaceLocation = this.destination_dportionPlaceLocation = null;
            this.wayptLocation = this.wayptPlaceId = null;

            var originInput = document.getElementById('location_from');
            var destinationInput = document.getElementById('location_to');
            var originPlaceAutocomplete = new google.maps.places.Autocomplete(originInput, {
                types: ['airport']
            });
            var destPlaceAutocomplete = new google.maps.places.Autocomplete(destinationInput, {
                types: ['airport']
            });


            // var originPlaceAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: originInput,
            //     type: 'airport',
            // });

            // var destPlaceAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: destinationInput,
            //     type: 'airport',
            // });


            this.directionsService = new google.maps.DirectionsService;
            this.directionsDisplay1 = new google.maps.DirectionsRenderer({
                draggable: true,
                polylineOptions: {
                    strokeColor: "#0688E9"
                },
                suppressMarkers: true
            });
            this.directionsDisplay2 = new google.maps.DirectionsRenderer({
                draggable: true,
                polylineOptions: {
                    strokeColor: "#0688E9"
                },
                suppressMarkers: true
            });
            this.directionsDisplay1.setMap(map);
            this.directionsDisplay2.setMap(map);

            this.setupAlgoliaPlaceChangedListener(originPlaceAutocomplete, 'ORIG');
            this.setupAlgoliaPlaceChangedListener(destPlaceAutocomplete, 'DEST');

            var originInput_dportion = document.getElementById('location_from_drivingportion');
            var destinationInput_dportion = document.getElementById('location_to_drivingportion');

            var origin_dportionAutocomplete = new google.maps.places.Autocomplete(originInput_dportion);

            var destination_dportionAutocomplete = new google.maps.places.Autocomplete(destinationInput_dportion);


            // var origin_dportionAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: originInput_dportion,
            //     type: '',
            // });
            // var destination_dportionAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: destinationInput_dportion,
            //     type: '',
            // });



            this.setupAlgoliaPlaceChangedListenerPortion(origin_dportionAutocomplete, 'ORIG', 'DRIVING');
            this.setupAlgoliaPlaceChangedListenerPortion(destination_dportionAutocomplete, 'DEST', 'DRIVING');

            var originInput_tportion = document.getElementById('location_from_trainportion');
            var destinationInput_tportion = document.getElementById('location_to_trainportion');

            var origin_tportionAutocomplete = new google.maps.places.Autocomplete(originInput_tportion, {
                types: ['train_station']
            });

            var destination_tportionAutocomplete = new google.maps.places.Autocomplete(destinationInput_tportion, {
                types: ['train_station']
            });

            // var origin_tportionAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: originInput_tportion,
            //     type: 'trainStation',
            // });
            // var destination_tportionAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: destinationInput_tportion,
            //     type: 'trainStation',
            // });
            this.setupAlgoliaPlaceChangedListenerPortion(origin_tportionAutocomplete, 'ORIG', 'TRANSIT');
            this.setupAlgoliaPlaceChangedListenerPortion(destination_tportionAutocomplete, 'DEST', 'TRANSIT');
            /*************************************************/
        }

        /************************* NEW **********************************/
        DrawPlaneDirectionsHandler.prototype.setupPlaceChangedListenerPortion = function(autocomplete, mode, ptype) {
            var me = this;
            autocomplete.bindTo('bounds', this.map);
            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();

                console.log('place', place);

                if (!place.place_id) {
                    window.alert("Please select an option from the dropdown list.");
                    return;
                }
                if (mode === 'ORIG') {
                    if (ptype == 'DRIVING') {
                        me.origin_dportionPlaceId = place.place_id;
                        me.origin_dportionPlaceLocation = place.geometry.location;
                    } else {
                        me.origin_tportionPlaceId = place.place_id;
                        me.origin_tportionPlaceLocation = place.geometry.location;
                    }
                } else {
                    if (ptype == 'DRIVING') {
                        me.destination_dportionPlaceId = place.place_id;
                        me.destination_dportionPlaceLocation = place.geometry.location;
                    } else {
                        me.destination_tportionPlaceId = place.place_id;
                        me.destination_tportionPlaceLocation = place.geometry.location;
                    }
                }

                me.portionroute(ptype);
            });
        };

        DrawPlaneDirectionsHandler.prototype.setupAlgoliaPlaceChangedListenerPortion = function(autocomplete, mode, ptype) {
            var me = this;

            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();

                if (place) {



                    if (!place.place_id) {
                        window.alert("Please select an option from the dropdown list.");
                        return;
                    }
                    if (mode === 'ORIG') {
                        if (ptype == 'DRIVING') {
                            me.origin_dportionPlaceId = place.place_id;
                            me.origin_dportionPlaceLocation = place.geometry.location;
                        } else {
                            me.origin_tportionPlaceId = place.place_id;
                            me.origin_tportionPlaceLocation = place.geometry.location;
                        }
                    } else {
                        if (ptype == 'DRIVING') {
                            me.destination_dportionPlaceId = place.place_id;
                            me.destination_dportionPlaceLocation = place.geometry.location;
                        } else {
                            me.destination_tportionPlaceId = place.place_id;
                            me.destination_tportionPlaceLocation = place.geometry.location;
                        }
                    }
                    me.portionroute(ptype);


                } else {
                    window.alert('No results found in google map.');
                }


            });


        };

        DrawPlaneDirectionsHandler.prototype.portionroute = function(ptype) {
            if (ptype == 'DRIVING') {
                if (!this.origin_dportionPlaceId || !this.destination_dportionPlaceId) {
                    return;
                }
            } else {
                if (!this.origin_tportionPlaceId || !this.destination_tportionPlaceId) {
                    return;
                }
            }
            var me = this;

            if (ptype == 'DRIVING') {
                document.getElementById('location_from_latlng_drivingportion').value = me.origin_dportionPlaceLocation;
                document.getElementById('location_to_latlng_drivingportion').value = me.destination_dportionPlaceLocation;
                var bounds = new google.maps.LatLngBounds();

                var marker_icon = new google.maps.MarkerImage(
                    'https://planiversity.com/assets/images/icon.png',
                    null,
                    // The origin for my image is 0,0.
                    new google.maps.Point(0, 0),
                    // The center of the image is 50,50 (my image is a circle with 100,100)
                    new google.maps.Point(50, 50)
                );

                var marker_destination = new google.maps.Marker({
                    position: new google.maps.LatLng(me.destination_dportionPlaceLocation.lat(), me.destination_dportionPlaceLocation.lng()),
                    // icon: 'https://planiversity.com/assets/images/icon.png',
                    icon: marker_icon,
                    label: {
                        text: markerAlpaArr[mark_number + 1],
                        color: "#ffffff",
                    }
                });

                marker_destination.setMap(map);

                bounds.extend(marker_destination.position);
                map.fitBounds(bounds);
            } else {
                document.getElementById('location_from_latlng_trainportion').value = me.origin_tportionPlaceLocation;
                document.getElementById('location_to_latlng_trainportion').value = me.destination_tportionPlaceLocation;
                var bounds = new google.maps.LatLngBounds();

                var marker_icon = new google.maps.MarkerImage(
                    'https://planiversity.com/assets/images/icon.png',
                    null,
                    // The origin for my image is 0,0.
                    new google.maps.Point(0, 0),
                    // The center of the image is 50,50 (my image is a circle with 100,100)
                    new google.maps.Point(50, 50)
                );

                var marker_destination = new google.maps.Marker({
                    position: new google.maps.LatLng(me.destination_tportionPlaceLocation.lat(), me.destination_tportionPlaceLocation.lng()),
                    // icon: 'https://planiversity.com/assets/images/icon.png',
                    icon: marker_icon,
                    label: {
                        text: markerAlpaArr[mark_number + 1],
                        color: "#ffffff",
                    }
                });

                marker_destination.setMap(map);

                bounds.extend(marker_destination.position);
                map.fitBounds(bounds);

            }
            this.directionsService.route({
                origin: {
                    'placeId': (ptype == "DRIVING" ? this.origin_dportionPlaceId : this.origin_tportionPlaceId)
                },
                destination: {
                    'placeId': (ptype == "DRIVING" ? this.destination_dportionPlaceId : this.destination_tportionPlaceId)
                },
                travelMode: google.maps.TravelMode[ptype]
            }, function(response, status) {
                if (status === 'OK') {
                    var line = new google.maps.Polyline({
                        path: response.routes[0].overview_path,
                        strokeColor: '#0688E9',
                        strokeOpacity: 1.0,
                        strokeWeight: 3
                    });
                    line.setMap(map);

                    me.fitBounds(me.bounds.union(response.routes[0].bounds));
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };

        /************************* NEW **********************************/
        DrawPlaneDirectionsHandler.prototype.setupPlaceChangedListener = function(autocomplete, mode) {
            var me = this;
            autocomplete.bindTo('bounds', this.map);
            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();
                if (!place.place_id) {
                    window.alert("Please select an option from the dropdown list.");
                    return;
                }
                if (mode === 'ORIG') {
                    me.originPlaceId = place.place_id;
                    me.originPlaceLocation = place.geometry.location;
                } else {
                    me.destinationPlaceId = place.place_id;
                    me.destinationPlaceLocation = place.geometry.location;
                    // portion change
                    me.origin_dportionPlaceId = place.place_id;
                    me.origin_dportionPlaceLocation = place.geometry.location;
                    // me.origin_fportionPlaceId = place.place_id;
                    // me.origin_fportionPlaceLocation = place.geometry.location;
                    me.origin_tportionPlaceId = place.place_id;
                    me.origin_tportionPlaceLocation = place.geometry.location;
                }
                me.route();
            });
        };
        DrawPlaneDirectionsHandler.prototype.setupAlgoliaPlaceChangedListener = function(autocomplete, mode) {
            var me = this;



            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();
                console.log('Typeping...', mode);

                console.log('place', place);



                if (place) {
                    if (mode === 'ORIG') {
                        me.originPlaceId = place.place_id;
                        me.originPlaceLocation = place.geometry.location;
                    } else {
                        me.destinationPlaceId = place.place_id;
                        me.destinationPlaceLocation = place.geometry.location;
                        // portion change
                        me.origin_dportionPlaceId = place.place_id;
                        me.origin_dportionPlaceLocation = place.geometry.location;
                        // me.origin_fportionPlaceId = place.place_id;
                        // me.origin_fportionPlaceLocation = place.geometry.location;
                        me.origin_tportionPlaceId = place.place_id;
                        me.origin_tportionPlaceLocation = place.geometry.location;
                    }
                    me.route();
                } else {
                    window.alert('No results found in google map.');
                }



            });


        };

        DrawPlaneDirectionsHandler.prototype.route = function() {
            if (!this.originPlaceId || !this.destinationPlaceId) {
                return;
            }
            var me = this;

            // clean map before start
            if (marker_origin != null) {
                marker_origin.setMap(null);
                marker_origin = null;
            };
            if (marker_destination != null) {
                marker_destination.setMap(null);
                marker_destination = null;
            };
            if (flightPath != null) {
                flightPath.setMap(null);
                flightPath = null;
            };
            var iconBase = 'https://planiversity.com/assets/images/';
            var marker_imageA = new google.maps.MarkerImage(
                'https://planiversity.com/assets/images/Selected_A.png',
                null,
                // The origin for my image is 0,0.
                new google.maps.Point(0, 0),
                // The center of the image is 50,50 (my image is a circle with 100,100)
                new google.maps.Point(50, 50)
            );
            var marker_imageB = new google.maps.MarkerImage(
                'https://planiversity.com/assets/images/Selected_B.png',
                null,
                // The origin for my image is 0,0.
                new google.maps.Point(0, 0),
                // The center of the image is 50,50 (my image is a circle with 100,100)
                new google.maps.Point(25, 50)
            );
            var bounds = new google.maps.LatLngBounds();
            marker_origin = new google.maps.Marker({
                position: this.originPlaceLocation,
                icon: marker_imageA
            });
            marker_destination = new google.maps.Marker({
                position: this.destinationPlaceLocation,
                icon: marker_imageB
            });
            marker_origin.setMap(this.map);
            marker_destination.setMap(this.map);
            bounds.extend(marker_origin.position);
            bounds.extend(marker_destination.position);

            document.getElementById('location_from_latlng').value = this.originPlaceLocation;
            document.getElementById('location_to_latlng').value = this.destinationPlaceLocation;
            //document.getElementById('location_from_drivingportion').value = document.getElementById('location_to').value;
            //document.getElementById('location_from_latlng_drivingportion').value = this.originPlaceLocation;

            var flightPlanCoordinates = [{
                    lat: this.originPlaceLocation.lat(),
                    lng: this.originPlaceLocation.lng()
                },
                {
                    lat: this.destinationPlaceLocation.lat(),
                    lng: this.destinationPlaceLocation.lng()
                }
            ];
            const lineSymbol = {
                path: "M 0,0 0,1",
                strokeOpacity: 1,
                scale: 3,
            };
            const lineSymbol1 = {
                path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                strokeOpacity: 1,
            };
            flightPath = new google.maps.Polyline({
                path: flightPlanCoordinates,
                geodesic: true,
                icons: [{
                        icon: lineSymbol,
                        offset: "0",
                        repeat: "20px",
                    },
                    {
                        icon: lineSymbol1,
                        offset: "100%",
                    },
                ],
                strokeColor: '#0688E9',
                strokeOpacity: 0,
                strokeWeight: 3
            });

            flightPath.setMap(this.map);
            this.map.fitBounds(bounds);
            mark_number = 1;
            // hide to and from content
            //show_win(2);
        };

        /**
         * @constructor
         */



        function AutocompleteDirectionsHandler(map) {
            this.map = map;
            this.originPlaceId = this.origin_dportionPlaceId = null;
            this.destinationPlaceId = this.destination_dportionPlaceId = null;
            this.originPlaceLocation = this.origin_dportionPlaceLocation = null;
            this.destinationPlaceLocation = this.destination_dportionPlaceLocation = null;
            this.wayptPlaceLocation = null;
            this.travelMode = '<?php echo $travelmode; ?>';
            var originInput = document.getElementById('location_from');
            var destinationInput = document.getElementById('location_to');
            switch (transportWay) {
                case "vehicle":
                    var inputType = null;
                    break;
                case "plane":
                    var inputType = "airport";
                    break;
                case "train":
                    var inputType = "train_station";
                    break;
                default:
                    var inputType = "";
                    break;
            }

            //alert(inputType);


            var originPlaceAutocomplete = new google.maps.places.Autocomplete(originInput, {
                types: [inputType]
            });

            var destPlaceAutocomplete = new google.maps.places.Autocomplete(destinationInput, {
                types: [inputType]
            });

            // var originPlaceAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: originInput,
            //     type: inputType,
            // });
            // var destPlaceAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: destinationInput,
            //     type: inputType,
            // });


            this.directionsService = new google.maps.DirectionsService;
            this.directionsDisplay = new google.maps.DirectionsRenderer({
                draggable: true,
                polylineOptions: {
                    strokeColor: "#0688E9"
                },
                suppressMarkers: true
            });
            this.directionsDisplay.setMap(map);

            this.directionsDisplay1 = new google.maps.DirectionsRenderer({
                draggable: true,
                polylineOptions: {
                    strokeColor: "#0688E9"
                },
                suppressMarkers: true
            });
            this.directionsDisplay2 = new google.maps.DirectionsRenderer({
                draggable: true,
                polylineOptions: {
                    strokeColor: "#0688E9"
                },
                suppressMarkers: true
            });
            this.directionsDisplay1.setMap(map);
            this.directionsDisplay2.setMap(map);
            directionsRenderer.addListener("directions_changed", () => {
                var result = directionsRenderer.getDirections();
                var points_arr = [];
                var via_waypoints = [];
                for (var j = 0; j < result.routes[0].legs.length; j++) {
                    var way_point = result.routes[0].legs[j];

                    for (var k = 0; k < way_point.via_waypoint.length; k++) {
                        var vlat = way_point.via_waypoint[k].location.lat();
                        var vlng = way_point.via_waypoint[k].location.lng();
                        via_waypoints.push({
                            lat: vlat,
                            lng: vlng,
                            index: j
                        });
                    }
                    for (var i = 0; i < way_point.steps.length; i++) {
                        var lat = way_point.steps[i].end_point.lat();
                        var lng = way_point.steps[i].end_point.lng();
                        var lat_lng = {
                            'lat': lat,
                            'lng': lng
                        };
                        points_arr.push(lat_lng);
                    }
                }

                if (result.routes[0].legs.length > 0) {
                    // get miles
                    var center_point = result.routes[0].overview_path.length / 2;
                    if (infowindow1) {
                        infowindow1.close();
                    }
                    infowindow1 = new google.maps.InfoWindow();
                    infowindow1.setContent("<div style='float:left; padding: 3px;'><img width='40' src='" + SITE + "images/car_icon.png'></div><div style='float:right; padding: 3px;'>" + calcTotalDistanceText(result) + "<br>" + calcTotalDurationText(result) + "</div>");
                    infowindow1.setPosition(result.routes[0].overview_path[center_point | 0]);
                    infowindow1.open(map);

                }
                via_waypoints = JSON.stringify(via_waypoints);
                $("#via_waypoints").val(via_waypoints);
            });

            this.setupAlgoliaPlaceChangedListener(originPlaceAutocomplete, 'ORIG');
            this.setupAlgoliaPlaceChangedListener(destPlaceAutocomplete, 'DEST');
            if (transportWay === 'train') {
                var originInput_dportion = document.getElementById('location_from_drivingportion');
                var destinationInput_dportion = document.getElementById('location_to_drivingportion');

                var origin_dportionAutocomplete = new google.maps.places.Autocomplete(originInput_dportion);

                var destination_dportionAutocomplete = new google.maps.places.Autocomplete(destinationInput_dportion);

                // var origin_dportionAutocomplete = places({
                //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
                //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
                //     container: originInput_dportion,
                //     type: '',
                // });
                // var destination_dportionAutocomplete = places({
                //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
                //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
                //     container: destinationInput_dportion,
                //     type: '',
                // });

                this.setupAlgoliaPlaceChangedListenerPortion(origin_dportionAutocomplete, 'ORIG', 'DRIVING');
                this.setupAlgoliaPlaceChangedListenerPortion(destination_dportionAutocomplete, 'DEST', 'DRIVING');
            } else {
                var originInput_tportion = document.getElementById('location_from_trainportion');
                var destinationInput_tportion = document.getElementById('location_to_trainportion');

                var origin_tportionAutocomplete = new google.maps.places.Autocomplete(originInput_tportion, {
                    types: ['train_station']
                });

                var destination_tportionAutocomplete = new google.maps.places.Autocomplete(destinationInput_tportion, {
                    types: ['train_station']
                });

                // var origin_tportionAutocomplete = places({
                //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
                //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
                //     container: originInput_tportion,
                //     type: 'trainStation',
                // });
                // var destination_tportionAutocomplete = places({
                //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
                //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
                //     container: destinationInput_tportion,
                //     type: 'trainStation',
                // });

                this.setupAlgoliaPlaceChangedListenerPortion(origin_tportionAutocomplete, 'ORIG', 'TRANSIT');
                this.setupAlgoliaPlaceChangedListenerPortion(destination_tportionAutocomplete, 'DEST', 'TRANSIT');
            }
            var originInput_fportion = document.getElementById('location_from_flightportion');
            var destinationInput_fportion = document.getElementById('location_to_flightportion');


            var origin_fportionAutocomplete = new google.maps.places.Autocomplete(originInput_fportion, {
                types: ['airport']
            });

            var destination_fportionAutocomplete = new google.maps.places.Autocomplete(destinationInput_fportion, {
                types: ['airport']
            });

            // var origin_fportionAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: originInput_fportion,
            //     type: 'airport',
            // });
            // var destination_fportionAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: destinationInput_fportion,
            //     type: 'airport',
            // });

            this.setupAlgoliaPlaceChangedListenerPortion(origin_fportionAutocomplete, 'ORIG', 'PLANE');
            this.setupAlgoliaPlaceChangedListenerPortion(destination_fportionAutocomplete, 'DEST', 'PLANE');
        }

        AutocompleteDirectionsHandler.prototype.setupPlaceChangedListenerPortion = function(autocomplete, mode, ptype) {
            var me = this;
            autocomplete.bindTo('bounds', this.map);
            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();
                if (!place.place_id) {
                    window.alert("Please select an option from the dropdown list.");
                    return;
                }

                if (mode === 'ORIG') {
                    if (ptype == 'DRIVING') {
                        me.origin_dportionPlaceId = place.place_id;
                        me.origin_dportionPlaceLocation = place.geometry.location;
                    }
                    if (ptype == 'TRANSIT') {
                        me.origin_tportionPlaceId = place.place_id;
                        me.origin_tportionPlaceLocation = place.geometry.location;
                    }
                    if (ptype == 'PLANE') {
                        me.origin_fportionPlaceId = place.place_id;
                        me.origin_fportionPlaceLocation = place.geometry.location;
                    }
                } else {
                    if (ptype == 'DRIVING') {
                        me.destination_dportionPlaceId = place.place_id;
                        me.destination_dportionPlaceLocation = place.geometry.location;
                    }
                    if (ptype == 'TRANSIT') {
                        me.destination_tportionPlaceId = place.place_id;
                        me.destination_tportionPlaceLocation = place.geometry.location;
                    }
                    if (ptype == 'PLANE') {
                        me.destination_fportionPlaceId = place.place_id;
                        me.destination_fportionPlaceLocation = place.geometry.location;
                    }
                }

                me.portionroute(ptype);
            });
        };

        AutocompleteDirectionsHandler.prototype.setupAlgoliaPlaceChangedListenerPortion = function(autocomplete, mode, ptype) {
            var me = this;

            autocomplete.addListener('change', function() {
                console.log('changing...');
            });



            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();


                if (place) {

                    if (mode === 'ORIG') {
                        if (ptype == 'DRIVING') {
                            me.origin_dportionPlaceId = place.place_id;
                            me.origin_dportionPlaceLocation = place.geometry.location;
                        }
                        if (ptype == 'TRANSIT') {
                            me.origin_tportionPlaceId = place.place_id;
                            me.origin_tportionPlaceLocation = place.geometry.location;
                        }
                        if (ptype == 'PLANE') {
                            me.origin_fportionPlaceId = place.place_id;
                            me.origin_fportionPlaceLocation = place.geometry.location;
                        }
                    } else {
                        if (ptype == 'DRIVING') {
                            me.destination_dportionPlaceId = place.place_id;
                            me.destination_dportionPlaceLocation = place.geometry.location;
                        }
                        if (ptype == 'TRANSIT') {
                            me.destination_tportionPlaceId = place.place_id;
                            me.destination_tportionPlaceLocation = place.geometry.location;
                        }
                        if (ptype == 'PLANE') {
                            me.destination_fportionPlaceId = place.place_id;
                            me.destination_fportionPlaceLocation = place.geometry.location;
                        }
                    }
                    me.portionroute(ptype);
                }

            });




        };

        AutocompleteDirectionsHandler.prototype.setupAlgoliaPlaceChangedListener = function(autocomplete, mode) {
            var me = this;
            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();
                if (place) {

                    if (mode === 'ORIG') {
                        me.originPlaceId = place.place_id;
                        me.originPlaceLocation = place.geometry.location;
                    } else if (mode === 'WAYPT') {
                        if (transportWay === 'vehicle') {
                            map = new google.maps.Map(document.getElementById('map'), {
                                mapTypeControl: false,
                                center: {
                                    lat: 40.730610,
                                    lng: -73.968285
                                },
                                mapTypeId: google.maps.MapTypeId.ROADMAP,
                                zoom: 5
                            });
                            directionsRenderer.setMap(map);
                        }
                        me.wayptPlaceId = place.place_id;
                        me.wayptPlaceLocation = place.geometry.location;
                    } else {
                        me.destinationPlaceId = place.place_id;
                        me.destinationPlaceLocation = place.geometry.location;
                        me.origin_dportionPlaceId = place.place_id;
                        me.origin_dportionPlaceLocation = place.geometry.location;
                        me.origin_fportionPlaceId = place.place_id;
                        me.origin_fportionPlaceLocation = place.geometry.location;
                        me.origin_tportionPlaceId = place.place_id;
                        me.origin_tportionPlaceLocation = place.geometry.location;
                    }
                    me.route();

                } else {
                    window.alert('No results found in google map.');
                }


            });

        };

        AutocompleteDirectionsHandler.prototype.portionroute = function(ptype) {
            if (ptype == 'DRIVING') {
                if (!this.origin_dportionPlaceId || !this.destination_dportionPlaceId) {
                    return;
                }
            }
            if (ptype == 'TRANSIT') {
                if (!this.origin_tportionPlaceId || !this.destination_tportionPlaceId) {
                    return;
                }
            }
            if (ptype == 'PLANE') {
                if (!this.origin_fportionPlaceId || !this.destination_fportionPlaceId) {
                    return;
                }
            }
            var me = this;

            if (ptype == 'DRIVING') {
                document.getElementById('location_from_latlng_drivingportion').value = me.origin_dportionPlaceLocation;
                document.getElementById('location_to_latlng_drivingportion').value = me.destination_dportionPlaceLocation;
                var bounds = new google.maps.LatLngBounds();

                var marker_icon = new google.maps.MarkerImage(
                    'https://planiversity.com/assets/images/icon.png',
                    null,
                    // The origin for my image is 0,0.
                    new google.maps.Point(0, 0),
                    // The center of the image is 50,50 (my image is a circle with 100,100)
                    new google.maps.Point(50, 50)
                );

                marker_destination = new google.maps.Marker({
                    position: me.destination_dportionPlaceLocation,
                    // icon: 'https://planiversity.com/assets/images/icon.png',
                    icon: marker_icon,
                    label: {
                        text: markerAlpaArr[mark_number + 1],
                        color: "#ffffff",
                    }
                });

                marker_destination.setMap(this.map);

                bounds.extend(marker_destination.position);
            }

            if (ptype == 'TRANSIT') {
                document.getElementById('location_from_latlng_trainportion').value = me.origin_tportionPlaceLocation;
                document.getElementById('location_to_latlng_trainportion').value = me.destination_tportionPlaceLocation;
                var bounds = new google.maps.LatLngBounds();

                var marker_icon = new google.maps.MarkerImage(
                    'https://planiversity.com/assets/images/icon.png',
                    null,
                    // The origin for my image is 0,0.
                    new google.maps.Point(0, 0),
                    // The center of the image is 50,50 (my image is a circle with 100,100)
                    new google.maps.Point(50, 50)
                );

                marker_destination = new google.maps.Marker({
                    position: me.destination_tportionPlaceLocation,
                    // icon: 'https://planiversity.com/assets/images/icon.png',
                    icon: marker_icon,
                    label: {
                        text: markerAlpaArr[mark_number + 1],
                        color: "#ffffff",
                    }
                });
                marker_destination.setMap(this.map);
                bounds.extend(marker_destination.position);
            }

            if (ptype == 'PLANE') {
                document.getElementById('location_from_latlng_flightportion').value = me.origin_fportionPlaceLocation;
                document.getElementById('location_to_latlng_flightportion').value = me.destination_fportionPlaceLocation;
            }

            if (ptype != 'PLANE') {

                this.directionsService.route({
                    origin: {
                        'placeId': (ptype == "DRIVING" ? this.origin_dportionPlaceId : this.origin_tportionPlaceId)
                    },
                    destination: {
                        'placeId': (ptype == "DRIVING" ? this.destination_dportionPlaceId : this.destination_tportionPlaceId)
                    },
                    travelMode: google.maps.TravelMode[ptype]
                }, function(response, status) {
                    if (status === 'OK') {
                        var line = new google.maps.Polyline({
                            path: response.routes[0].overview_path,
                            strokeColor: '#0688E9',
                            strokeOpacity: 1.0,
                            strokeWeight: 3
                        });
                        line.setMap(map);

                        me.fitBounds(me.bounds.union(response.routes[0].bounds));
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });

            } else {

                this.map = map;
                var bounds = new google.maps.LatLngBounds();
                if (marker_origin) {
                    marker_origin.setMap(null);
                }

                if (marker_destination) {
                    marker_destination.setMap(null);
                }

                var marker_icon = new google.maps.MarkerImage(
                    'https://planiversity.com/assets/images/icon.png',
                    null,
                    // The origin for my image is 0,0.
                    new google.maps.Point(0, 0),
                    // The center of the image is 50,50 (my image is a circle with 100,100)
                    new google.maps.Point(50, 50)
                );

                marker_destination = new google.maps.Marker({
                    position: me.destination_fportionPlaceLocation,
                    // icon: 'https://planiversity.com/assets/images/icon.png',
                    icon: marker_icon,
                    label: {
                        text: markerAlpaArr[mark_number + 1],
                        color: "#ffffff",
                    }
                });
                marker_destination.setMap(this.map);
                bounds.extend(marker_destination.position);

                var flightPlanCoordinates = [{
                        lat: me.origin_fportionPlaceLocation.lat(),
                        lng: me.origin_fportionPlaceLocation.lng()
                    },
                    {
                        lat: me.destination_fportionPlaceLocation.lat(),
                        lng: me.destination_fportionPlaceLocation.lng()
                    }
                ];
                if (flightPath) {
                    flightPath.setMap(null);
                }
                flightPath = new google.maps.Polyline({
                    path: flightPlanCoordinates,
                    geodesic: true,
                    strokeColor: '#0688E9',
                    strokeOpacity: 1.0,
                    strokeWeight: 3
                });

                flightPath.setMap(this.map);
                this.map.fitBounds(bounds);
            }

        };

        AutocompleteDirectionsHandler.prototype.setupPlaceChangedListener = function(autocomplete, mode) {
            var me = this;
            autocomplete.bindTo('bounds', this.map);
            autocomplete.addListener('place_changed', function() {
                var place = autocomplete.getPlace();
                if (!place.place_id) {
                    window.alert("Please select an option from the dropdown list.");
                    return;
                }
                if (mode === 'ORIG') {
                    me.originPlaceId = place.place_id;
                    me.originPlaceLocation = place.geometry.location;
                } else if (mode === 'WAYPT') {
                    if (transportWay === 'vehicle') {
                        map = new google.maps.Map(document.getElementById('map'), {
                            mapTypeControl: false,
                            center: {
                                lat: 40.730610,
                                lng: -73.968285
                            },
                            mapTypeId: google.maps.MapTypeId.ROADMAP,
                            zoom: 7
                        });
                        directionsRenderer.setMap(map);
                    }
                    me.wayptPlaceId = place.place_id;
                    me.wayptPlaceLocation = place.geometry.location;
                } else {
                    me.destinationPlaceId = place.place_id;
                    me.destinationPlaceLocation = place.geometry.location;
                    me.origin_dportionPlaceId = place.place_id;
                    me.origin_dportionPlaceLocation = place.geometry.location;
                    me.origin_fportionPlaceId = place.place_id;
                    me.origin_fportionPlaceLocation = place.geometry.location;
                    me.origin_tportionPlaceId = place.place_id;
                    me.origin_tportionPlaceLocation = place.geometry.location;

                }
                me.route();
            });
        };

        AutocompleteDirectionsHandler.prototype.route = function() {
            if (!this.originPlaceId || !this.destinationPlaceId) {
                return;
            }

            var me = this;
            document.getElementById('location_from_latlng').value = me.originPlaceLocation;
            document.getElementById('location_to_latlng').value = me.destinationPlaceLocation;
            var waypts = [];
            var destPID = this.destinationPlaceId;
            if (transportWay === 'vehicle') {
                if (me.wayptPlaceLocation != null) {
                    waypts.push({
                        location: me.wayptPlaceLocation,
                        stopover: true
                    });
                    destPID = me.wayptPlaceId;
                }
                if (waypoints.length > 0) {
                    waypts = waypts.concat(waypoints)
                }
                directionsService.route({
                    origin: {
                        'placeId': this.originPlaceId
                    },
                    destination: {
                        'placeId': this.destinationPlaceId
                    },
                    waypoints: waypts,
                    optimizeWaypoints: true,
                    travelMode: this.travelMode,
                }, function(response, status) {
                    if (status === 'OK') {
                        // me.directionsDisplay
                        directionsRenderer.setDirections(response);
                        var my_route = response.routes[0];
                        addMarker(my_route)
                    } else {
                        window.alert('Directions ** request failed due to ' + status);
                    }
                });
            } else {
                if (me.wayptPlaceLocation != null) {
                    waypts.push({
                        location: me.destinationPlaceLocation,
                        stopover: true
                    });
                    destPID = me.wayptPlaceId;
                }
                this.directionsService.route({
                    origin: {
                        'placeId': this.originPlaceId
                    },
                    destination: {
                        'placeId': destPID
                    },
                    waypoints: waypts,
                    optimizeWaypoints: true,
                    travelMode: this.travelMode,
                    transitOptions: {
                        modes: ['TRAIN'],
                        routingPreference: 'FEWER_TRANSFERS'
                    },

                }, function(response, status) {
                    if (status === 'OK') {
                        var line2 = new google.maps.Polyline({
                            path: response.routes[0].overview_path,
                            strokeColor: '#0688E9',
                            strokeOpacity: 1.0,
                            strokeWeight: 3
                        });
                        line2.setMap(map);

                        var center_point2 = response.routes[0].overview_path.length / 2;
                        var infowindow2 = new google.maps.InfoWindow();
                        infowindow2.setContent("<div style='float:left; padding: 3px;'><img width='40' src='" + SITE + "images/train_icon2.png'></div><div style='float:right; padding: 3px;'>" + response.routes[0].legs[0].distance.text + "<br>" + response.routes[0].legs[0].duration.text + "</div>");
                        infowindow2.setPosition(response.routes[0].overview_path[center_point2 | 0]);
                        infowindow2.open(map);
                        addMarker(response.routes[0])
                        me.directionsDisplay.setDirections(response);
                    } else {
                        window.alert('Directions ** request failed due to ' + status);
                    }
                });
            }
        };
        $("#checkbox-hotel").click(function() {
            var dep = $("#location_datel").val();
            var arr = $("#location_dater").val();
            if (this.checked == true)
                $("#hotel_date_checkin").val(dep);
            $("#hotel_date_checkout").val(arr);
        });
        $("#checkbox-car-rental").click(function() {
            var dep = $("#location_datel").val();
            var arr = $("#location_dater").val();
            if (this.checked == true)
                $("#rental_date_pick").val(dep);
            $("#rental_date_drop").val(arr);
        });

        $("#rental_agency_located").click(function() {
            if (this.checked == true) {
                $("#rental_agency_address").hide();
                // $('#rental_agency_address').prop('required',false);
            } else {
                $("#rental_agency_address").show();
                // $("#rental_agency_address").prop('required',true);
            }
        });
        $("#hotel_located").click(function() {
            if (this.checked == true) {
                $("#hotel_address").hide();
                // $('#hotel_address').prop('required',false);
            } else {
                $("#hotel_address").show();
                // $("#hotel_address").prop('required',true);
            }
        });
        $('input[type=radio][name=location_triptype]').change(function() {
            if (transportWay === 'train') { // plane or vehicle
                return;
            }
            if (this.value == 'o') {
                $("#return").hide();
            } else {
                $("#return").show();
            }
            if (this.value == 'm') {
                $("#waypts_div").show();
                if (transportWay === 'vehicle') {
                    $("#addmorebtnmaindiv").show();
                }
            } else {
                $("#waypts_div").val('');
                $("#waypts_div").hide();
            }
        });

        function toggle_visibility(id) {
            var e = document.getElementById(id);
            if (e.style.display == 'block')
                e.style.display = 'none';
            else
                e.style.display = 'block';
            setDrivingAndTrain();
        }

        $(window).on('load', function() {
            $('#schedule-modal').modal('show');
            $("#return").hide();
        });

        $(".close").click(function() {
            if ($("#schedule-modal").hasClass('modaltrans')) {
                $("#schedule-modal").removeClass('modaltrans');
                $("#schedule-modal-body").removeClass('modaltrans-body');
                $("#schedule-modal-body").removeClass('modaltrans-body-mozila');
                $("#myLargeModalLabel").css({
                    fontSize: 21
                });
                // $('#schedule-modal').modal('show');
                $(this).html("-");
            } else {
                $("#schedule-modal").addClass('modaltrans');
                if (window.navigator.userAgent.indexOf("Chrome") > -1) {
                    $("#schedule-modal-body").addClass('modaltrans-body');
                } else {
                    $("#schedule-modal-body").addClass('modaltrans-body-mozila');
                }

                $("#myLargeModalLabel").css({
                    fontSize: 15
                });
                // $('#schedule-modal').collapse()
                // $('#schedule-modal').modal('show');
                $(this).html("+");
            }
        });

        var add_more_stop_count = 1
        var multi_arr_value = [];
        // var waypoints = [];
        var currentWriteIndex = null;
        var currentChangeIndex = null;
        var wayptAutocompleteVar = [];
        var is_update = null;
        var i = 0;
        var place = "";

        function addLocationToStop(index) {
            switch (transportWay) {
                case "vehicle":
                    var inputType = "";
                    var mapType = 'DRIVING';
                    break;
                case "plane":
                    var inputType = "airport";
                    var mapType = 'TRANSIT';
                    break;
                case "train":
                    var inputType = "trainStation";
                    var mapType = 'TRANSIT';
                    break;
                default:
                    var inputType = "";
                    var mapType = 'DRIVING';
                    break;
            }
            // wayptAutocompleteVar[index] = new google.maps.places.Autocomplete(document.getElementById('multi_location_waypoint' + index), {types: ['establishment']});
            // wayptAutocompleteVar[index] = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: document.getElementById("multi_location_waypoint" + index),
            //     type: inputType
            // });

            //wayptAutocompleteVar[index] = document.getElementById("multi_location_waypoint" + index);

            wayptAutocompleteVar[index] = new google.maps.places.Autocomplete(document.getElementById("multi_location_waypoint" + index), {
                types: ['airport']
            });

            // wayptAutocompleteVar[index].bindTo('bounds', map);

            wayptAutocompleteVar[index].addListener('place_changed', function() {
                var place = wayptAutocompleteVar[index].getPlace();

                map = new google.maps.Map(document.getElementById('map'), {
                    mapTypeControl: false,
                    center: {
                        lat: 40.730610,
                        lng: -73.968285
                    },
                    // mapTypeId: mapType,
                    zoom: 7
                });

                directionsRenderer.setMap(map);
                is_update = null;
                i = 0;
                currentWriteIndex = currentChangeIndex;
                //var geocoder = new google.maps.Geocoder;
                //var latlng = e.suggestion.latlng;


                if (place) {

                    if (multi_arr_value.length == 0) {
                        multi_arr_value.push({
                            id: currentWriteIndex,
                            location_multi_waypoint_latlng: place.geometry.location.lat() + ',' + place.geometry.location.lng()
                        })
                        waypoints.push({
                            location: place.geometry.location,
                            stopover: true
                        })
                    } else {
                        multi_arr_value.push({
                            id: currentWriteIndex,
                            location_multi_waypoint_latlng: place.geometry.location.lat() + ',' + place.geometry.location.lng()
                        })

                        waypoints.push({
                            location: place.geometry.location,
                            stopover: true
                        })

                        /*for (i = 0; i < multi_arr_value.length; i++) {
                            if (multi_arr_value[i].id == currentWriteIndex) {
                                is_update = i;
                                waypoints[i].location = place.geometry.location
                            }

                            if (multi_arr_value.length == i + 1) {
                                if (multi_arr_value[is_update]) {
                                    if (is_update != null) {
                                        multi_arr_value[is_update].location_multi_waypoint_latlng = place.geometry.location.lat() + ',' + place.geometry.location.lng()
                                    } else {
                                        multi_arr_value.push({
                                            id: currentWriteIndex,
                                            location_multi_waypoint_latlng: place.geometry.location.lat() + ',' + place.geometry.location.lng()
                                        })
                                        waypoints.push({
                                            location: place.geometry.location,
                                            stopover: true
                                        })
                                    }
                                } else {
                                    multi_arr_value.push({
                                        id: currentWriteIndex,
                                        location_multi_waypoint_latlng: place.geometry.location.lat() + ',' + place.geometry.location.lng()
                                    })
                                    waypoints.push({
                                        location: place.geometry.location,
                                        stopover: true
                                    })
                                }
                            }
                        }*/
                    }

                    document.getElementById('location_multi_waypoint_latlng').value = JSON.stringify(multi_arr_value)
                    var way_ponts = waypoints
                    switch (transportWay) {
                        case "vehicle":
                            var request = {
                                origin: document.getElementById('location_from').value,
                                destination: document.getElementById('location_to').value,
                                waypoints: way_ponts,
                                optimizeWaypoints: true,
                                travelMode: mapType,
                            };
                            directionsService.route(request, function(result, status) {
                                if (status == 'OK') {
                                    directionsRenderer.setDirections(result);
                                    var my_route = result.routes[0];
                                    addMarker(my_route);
                                }
                            });

                            break;
                        case "plane":

                            // console.log('plane multiple');
                            var originPlaceLocation = document.getElementById('location_from_latlng').value;
                            var destinationPlaceLocation = document.getElementById('location_to_latlng').value;
                            originPlaceLocation = convertLatLngStrToArray(originPlaceLocation);
                            destinationPlaceLocation = convertLatLngStrToArray(destinationPlaceLocation);
                            var bounds = new google.maps.LatLngBounds();
                            var marker_imageA = new google.maps.MarkerImage(
                                'https://planiversity.com/assets/images/Selected_A.png',
                                null,
                                // The origin for my image is 0,0.
                                new google.maps.Point(0, 0),
                                // The center of the image is 50,50 (my image is a circle with 100,100)
                                new google.maps.Point(50, 50)
                            );

                            var mk = new google.maps.Marker({
                                position: new google.maps.LatLng(originPlaceLocation[0] * 1, originPlaceLocation[1] * 1),
                                icon: marker_imageA,
                                label: {
                                    text: markerAlpaArr[0],
                                    color: "#ffffff",
                                }
                            });
                            mk.setMap(map);
                            bounds.extend(mk.position);


                            const lineSymbol = {
                                path: "M 0,0 0,1",
                                strokeOpacity: 1,
                                scale: 3,
                            };
                            const lineSymbol1 = {
                                path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                                strokeOpacity: 1,
                            };

                            var flightPlanCoordinates = [{
                                lat: originPlaceLocation[0] * 1,
                                lng: originPlaceLocation[1] * 1
                            }];
                            for (var i = 0; i < waypoints.length; i++) {
                                flightPlanCoordinates.push({
                                    lat: waypoints[i].location.lat(),
                                    lng: waypoints[i].location.lng()
                                });
                                mk = new google.maps.Marker({
                                    position: new google.maps.LatLng(waypoints[i].location.lat(), waypoints[i].location.lng()),
                                    icon: marker_imageA,
                                    label: {
                                        text: markerAlpaArr[i + 1],
                                        color: "#ffffff",
                                    }
                                });
                                mk.setMap(map);
                                bounds.extend(mk.position);
                            }
                            flightPlanCoordinates.push({
                                lat: destinationPlaceLocation[0] * 1,
                                lng: destinationPlaceLocation[1] * 1
                            })
                            flightPath = new google.maps.Polyline({
                                path: flightPlanCoordinates,
                                geodesic: true,
                                icons: [{
                                        icon: lineSymbol,
                                        offset: "0",
                                        repeat: "20px",
                                    },
                                    {
                                        icon: lineSymbol1,
                                        offset: "100%",
                                    },
                                ],
                                strokeColor: '#0688E9',
                                strokeOpacity: 0,
                                strokeWeight: 3
                            });
                            flightPath.setMap(map);
                            var mindex = waypoints.length + 1;
                            mark_number = mindex;
                            mk = new google.maps.Marker({
                                position: new google.maps.LatLng(destinationPlaceLocation[0] * 1, destinationPlaceLocation[1] * 1),
                                icon: marker_imageA,
                                label: {
                                    text: markerAlpaArr[mindex],
                                    color: "#ffffff",
                                }
                            });
                            mk.setMap(map);
                            bounds.extend(mk.position);
                            map.fitBounds(bounds);
                            break;
                        case "train":
                            break;
                    }
                }


            });


        }

        var addMoreLabel = ["First", "Second", "Third", "Fourth", "Fifth", "Sixth", "Seventh", "8th", "9th"];
        $('#addMoreStop').click(function() {
            if ($('#append_more_stop').length) {
                var html = `<div class="set set${add_more_stop_count}">
                                <div class="close_item" onclick="removeMultiStop(${add_more_stop_count})">
                                    <i class="fa fa-times" aria-hidden="true" onclick="removeMultiStop(${add_more_stop_count})"></i>
                                </div>
                                <a href="javascript:void(0)" onclick="collapse(this, ${add_more_stop_count})">
                                    Stop 0${add_more_stop_count + 1}
                                    <i class="fa fa-angle-down"></i>
                                </a>
                                <div class="content content${add_more_stop_count}">
                                    <div class="accordion_container_item_first">
                                        <div class="row">
                                            <div class="col-xl-12 col-lg-12">
                                                <div class="form-group">
                                                    <label>Destination</label>
                                                    <input type="text" name="multi_location_waypoint[]" onfocus="onWayPointKeyUp(this)" id="multi_location_waypoint${add_more_stop_count}" class="form-control" placeholder="Destination">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xl-6 col-lg-6">
                                                <div class="form-group">
                                                    <label>Arrival Date</label>
                                                    <div class="date_picker_item">
                                                        <input type="text" name="multi_location_waypoint_date[]" id="multi_location_waypoint_date${add_more_stop_count}" class="form-control datepicker" placeholder="Arrival Date" value="">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-6 col-lg-6">
                                                <div class="form-group">
                                                    <label>Date of Departure</label>
                                                    <div class="date_picker_item">
                                                        <input type="text" name="multi_location_waypoint_dep_date[]" id="multi_location_waypoint_dep_date${add_more_stop_count}" class="form-control datepicker" placeholder="Date of Departure" value="">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>`;
                <?php if ($transport != 'vehicle') { ?>
                    html += `<div class="add_stop_flight_de">
                                        <div class="add_stop_flight_de_item">
                                            <div class="row">
                                                <div class="col-xl-6 col-lg-6">
                                                    <div class="form-group">
                                                        <label><?php echo $label; ?> Number</label>
                                                        <div class="date_picker_item">
                                                            <input type="text" name="multi_waypoint_flight_no[]" class="form-control" placeholder="<?php echo $label; ?> Number" value="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-xl-6 col-lg-6">
                                                    <div class="form-group">
                                                        <label>Seat Number</label>
                                                        <input type="text" name="multi_waypoint_seat_no[]" class="form-control" placeholder="Seat Number" value="">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>`;
                <?php } ?>
                html += `<div class="add_hotel_details_list">
                                        <div class="add_hotel_details_items">
                                            <div class="row">
                                                <div class="col-xl-12">
                                                    <label for="add_hotel_detail">
                                                        <input type="checkbox" onclick="add_hotel_detail(this, ${add_more_stop_count})" id="add_hotel_detail${add_more_stop_count}" />
                                                        Add Hotel Details
                                                    </label>
                                                </div>
                                            </div>
                                            <div id="add_hotel_detail_value${add_more_stop_count}" style="display: none">
                                                <div class="row">
                                                    <div class="col-xl-12">
                                                        <div class="form-group">
                                                            <label>Hotel Name</label>
                                                            <input type="text" name="stop_hotelname[]" class="form-control" placeholder="Hotel Name" value="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-xl-12">
                                                        <div class="form-group">
                                                            <label>Hotel Address</label>
                                                            <input type="text" name="stop_hoteladdress[]" onfocus="onWayPointKeyUp(this)" class="form-control" id="multi_location_waypoint${add_more_stop_count}_hotel_addr" placeholder="Hotel Address Custom"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="add_rental_car_detai_sec">
                                            <div class="row">
                                                <div class="col-xl-12">
                                                    <label for="add_rental_deta_check">
                                                        <input type="checkbox" onclick="add_rental_detail(this, ${add_more_stop_count})" id="add_rental_deta_check${add_more_stop_count}" />
                                                        Add Rental Car Details
                                                    </label>
                                                </div>
                                            </div>
                                            <div id="add_rental_deta_check_value${add_more_stop_count}" style="display: none">
                                                <div class="row">
                                                    <div class="col-xl-12">
                                                        <div class="form-group">
                                                            <label>Rental Agency</label>
                                                            <input type="text" name="stop_rentalagency[]" class="form-control" placeholder="Rental Agency" value="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-xl-12">
                                                        <div class="form-group">
                                                            <label>Rental Agency Address</label>
                                                            <input type="text" name="stop_rentaladdress[]" onfocus="onWayPointKeyUp(this)" id="multi_location_waypoint${add_more_stop_count}_agency_addr" class="form-control" placeholder="Rental Agency Address 2"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;

                $('#append_more_stop').append(html);

                addLocationToStop(add_more_stop_count);
                addLocationToStop(add_more_stop_count + "_hotel_addr");
                addLocationToStop(add_more_stop_count + "_agency_addr");

                $('#multi_location_waypoint_date' + add_more_stop_count).datepicker({
                    format: 'yyyy-mm-dd',
                    autoclose: true
                })

                $('#multi_location_waypoint_dep_date' + add_more_stop_count).datepicker({
                    format: 'yyyy-mm-dd',
                    autoclose: true
                })

                add_more_stop_count++;
            }
        });

        function removeMultiStop(stop_id) {
            $(".set" + stop_id).remove();
            for (var i = 0; i < multi_arr_value.length; i++) {
                if (multi_arr_value[i].id == stop_id) {
                    multi_arr_value.splice(i, 1)
                    waypoints.splice(i, 1);
                    var way_ponts = waypoints
                    var request = {
                        origin: document.getElementById('location_from').value,
                        destination: document.getElementById('location_to').value,
                        waypoints: way_ponts,
                        optimizeWaypoints: true,
                        travelMode: 'DRIVING'
                    };
                    directionsService.route(request, function(result, status) {
                        if (status == 'OK') {
                            var my_route = result.routes[0];
                            addMarker(my_route)
                            directionsRenderer.setDirections(result);
                        }
                    });
                    document.getElementById('location_multi_waypoint_latlng').value = JSON.stringify(multi_arr_value)
                    break;
                }
            }
        }

        function onWayPointKeyUp(e) {
            currentChangeIndex = e.getAttribute("index");
        }

        function removeStop(value) {
            $('#more_block' + value).remove()
            for (var i = 0; i < multi_arr_value.length; i++) {
                if (multi_arr_value[i].id == value) {
                    multi_arr_value.splice(i, 1)
                    waypoints.splice(i, 1);
                    var way_ponts = waypoints
                    var request = {
                        origin: document.getElementById('location_from').value,
                        destination: document.getElementById('location_to').value,
                        waypoints: way_ponts,
                        optimizeWaypoints: true,
                        travelMode: 'DRIVING'
                    };
                    directionsService.route(request, function(result, status) {
                        if (status == 'OK') {
                            var my_route = result.routes[0];
                            addMarker(my_route)
                            directionsRenderer.setDirections(result);
                        }
                    });
                    document.getElementById('location_multi_waypoint_latlng').value = JSON.stringify(multi_arr_value)
                    break;
                }
            }
        }

        function setDrivingAndTrain() {
            setTimeout(function() {
                var location_to = document.getElementById("location_to");
                location_to = location_to.value;
                var statusDriving = $("#driving").css('display');
                var statusFlight = $("#flight").css('display');
                var statusTrain = $("#train").css('display');

                if (statusDriving === "block" && transportWay !== 'train') {
                    $("#location_from_drivingportion").val(location_to);
                    var reAutocomplete = new google.maps.places.Autocomplete(document.getElementById("location_from_drivingportion"));

                    // var reAutocomplete = places({
                    //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
                    //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
                    //     container: document.getElementById("location_from_drivingportion"),
                    //     type: '',
                    // });

                } else {
                    $("#location_from_drivingportion").val("");
                }

                if (statusFlight === "block" && transportWay !== 'train') {
                    $("#location_from_flightportion").val(location_to);

                    var reAutocomplete = new google.maps.places.Autocomplete(document.getElementById("location_from_flightportion"));

                    // var reAutocomplete = places({
                    //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
                    //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
                    //     container: document.getElementById("location_from_flightportion"),
                    //     type: '',
                    // });
                } else {
                    $("#location_from_flightportion").val("");
                }

                if (statusTrain === "block") {
                    $("#location_from_trainportion").val(location_to);

                    var reAutocomplete = new google.maps.places.Autocomplete(document.getElementById("location_from_trainportion"), {
                        types: ['train_station']
                    });
                    // var reAutocomplete = places({
                    //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
                    //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
                    //     container: document.getElementById("location_from_trainportion"),
                    //     type: '',
                    // });
                } else {
                    $("#location_from_trainportion").val("");
                }
            }, 100);
        }

        var dateToday = new Date();

        var datePickerOptions = {
            format: 'yyyy-mm-dd',
            autoclose: true,
        }

        // custom function for current page.
        $(document).ready(function() {
            $(document).on("change", "#location_to", function() {
                setDrivingAndTrain();
            });

            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true
            });

            $('.datepicker_one').datepicker(datePickerOptions)

            setTimeout(function() {
                addLocationToStop(0);
                addLocationToStop('0_hotel_addr');
                addLocationToStop('0_agency_addr');
            }, 1000);


            // var hotelAddressPlaceAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: hotel_address,
            //     type: 'address',
            // });

            // var rental_agency_address = document.getElementById('rental_agency_address');
            // var rentalAgencyAddressPlaceAutocomplete = places({
            //     appId: '<?php echo ALGOLIA_PLACES_APP_ID; ?>',
            //     apiKey: '<?php echo ALGOLIA_PLACES_API_KEY; ?>',
            //     container: rental_agency_address,
            //     type: 'address',
            // });
        });
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcMVuiPorZzfXIMmKu2Y2BVBgTFfdhJ2Y&libraries=places&callback=initMap" async defer></script>

    <script>
        $(document).ready(function($) {
            $(".accordion1")
                .find(".accordion-toggle")
                .click(function() {
                    // modified from union deisgn+code at http://uniondesign.ca/simple-accordion-without-jquery-ui/
                    // mc 4/2/2015
                    //Expand or collapse this panel
                    var isActive = $(this).hasClass("active");
                    $(".accordion-toggle").removeClass("active");
                    if (!isActive) {
                        $(this).toggleClass("active");
                    }

                    $(this).next().slideToggle("fast");
                    //Hide the other panels
                    $(".accordion-content").not($(this).next()).slideUp("fast");
                });
            $(".accordion2")
                .find(".accordion-toggle2")
                .click(function() {
                    // modified from union deisgn+code at http://uniondesign.ca/simple-accordion-without-jquery-ui/
                    // mc 4/2/2015
                    //Expand or collapse this panel
                    var isActive = $(this).hasClass("active");
                    $(".accordion-toggle2").removeClass("active");
                    if (!isActive) {
                        $(this).toggleClass("active");
                    }

                    $(this).next().slideToggle("fast");
                    //Hide the other panels
                    $(".accordion-content").not($(this).next()).slideUp("fast");
                });

        });
    </script>

    <script>
        function add_rental_detail(e, id) {
            if ($(e).is(":checked")) {
                $("#add_rental_deta_check_value" + id).show();
            } else {
                $("#add_rental_deta_check_value" + id).hide();
            }
        }

        function add_hotel_detail(e, id) {
            if ($(e).is(":checked")) {
                $("#add_hotel_detail_value" + id).show();
            } else {
                $("#add_hotel_detail_value" + id).hide();
            }
        }

        function collapse(e, id) {
            if ($(e).hasClass("active")) {
                $(e).removeClass("active");
                $(e).siblings(".content" + id + "").slideUp(200);
                $(".set" + id + " > a i").removeClass("fa-angle-up").addClass("fa-angle-down");
            } else {
                $(".set" + id + " > a i").removeClass("fa-angle-up").addClass("fa-angle-down");
                $(e).find("i").removeClass("fa-angle-down").addClass("fa-angle-up");
                $(".set" + id + " > a").removeClass("active");
                $(e).addClass("active");
                $(".content" + id + "").slideUp(200);
                $(e).siblings(".content" + id + "").slideDown(200);
            }
        }
    </script>
</body>

</html>